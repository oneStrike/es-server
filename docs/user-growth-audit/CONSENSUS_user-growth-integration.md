# 共识阶段（CONSENSUS）- 漫画与论坛成长系统接入改造

## 1. 明确需求描述
- 以成长事件为统一入口，实现漫画与论坛的成长接入全覆盖
- 成长事件必须可审计、可幂等、可补偿
- 成长规则在业务侧计算结果与后台一致
- 奖励展示、领取与成长通知完整可验证
- 运营配置变更 5 分钟内生效

## 2. 验收标准
- 论坛域所有成长行为均通过成长事件上报，不再直接调用积分/经验服务
- 漫画域成长事件补齐统一事件键与上下文
- 成长事件审计表记录事件状态、命中规则与处理结果
- 规则匹配逻辑以 business + eventKey 为主键
- 成长奖励可从 app-api 获取并进行领取与刷新
- 成长事件触发站内信/Push/弹窗/红点
- 运营配置变更在 5 分钟内对新事件生效

## 3. 技术实现方案与约束

### 3.1 事件驱动统一
- 业务域只负责发布事件
- 成长域负责订阅、计算、落库与通知

### 3.2 规则匹配与复用
- 规则 DTO 与 constant 统一管理并复用
- 规则表结构扩展以支持 business + eventKey

### 3.3 注释与规范
- 关键算法与边界需明确注释
- DTO 与常量严格复用，避免重复定义
- 遵循项目已有依赖注入与模块组织规范

## 4. 边界限制
- 不引入新的外部服务依赖
- 不改变现有业务对外接口语义
- 数据迁移可向后兼容

## 5. 关键假设确认
- 允许新增审计表与迁移
- 允许增加 app-api/admin-api 接口
- 允许论坛域事件化改造
