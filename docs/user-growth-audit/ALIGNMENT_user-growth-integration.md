# 对齐阶段（ALIGNMENT）- 漫画与论坛成长系统接入改造

## 1. 项目上下文分析

### 1.1 项目结构与技术栈
- Monorepo 结构，apps 与 libs 分离
- 后端框架为 NestJS
- 数据访问基于 Prisma
- 业务域模块分布在 libs/content、libs/forum、libs/user
- app-api 与 admin-api 分别提供客户端与运营端接口

### 1.2 相关模块现状
- 漫画域已发布部分成长事件（view/like/favorite/read/purchase/download）
- 论坛域仍存在直接积分调用与未事件化行为
- 成长事件总线仅发布，不含消费、审计与规则匹配
- app-api 未发现成长奖励展示/领取与成长通知接口
- admin-api 存在成长规则管理入口，但无热更新策略

### 1.3 业务域与数据模型
- 用户成长核心要素：积分、经验、等级、徽章、特权
- 规则来源：运营侧配置，需与业务端一致生效
- 关键行为：漫画阅读/互动、论坛发帖/回帖/互动/举报等

## 2. 需求边界确认

### 2.1 本次任务范围
- 建立完整成长事件链路（发布、消费、审计、补偿）
- 论坛域行为事件化
- 成长规则匹配统一化并输出一致结果
- 成长奖励展示/领取与通知链路补齐
- 运营配置变更 5 分钟内生效
- 满足项目规范：注释明确、DTO 与 constant 高复用

### 2.2 不在本次范围
- 业务功能扩展与产品层新增需求
- 客户端 UI 实现与视觉交付
- 已有业务逻辑的非成长相关重构

## 3. 需求理解与关键假设

### 3.1 需求理解
- 目标是让漫画与论坛行为完整触发成长系统，并由成长系统统一结算
- 成长规则以 business + eventKey 维度进行匹配
- 奖励与通知必须可验证且可追踪

### 3.2 关键假设
- 允许在 libs/user 中新增成长事件消费与审计服务
- 允许在 prisma 增加成长事件审计表与索引
- 允许在 app-api 与 admin-api 增加新的成长相关接口
- 允许调整论坛域积分直连逻辑为事件驱动

## 4. 不确定性与待确认项
- 成长事件审计表字段标准与索引策略
- 成长事件幂等窗口与重试策略阈值
- 通知通道的具体触发规范与优先级
- 热更新触发方式（缓存版本号或主动失效）

## 5. 输出物与阶段成果
- ALIGNMENT：当前文档
- 后续阶段将输出 CONSENSUS、DESIGN、TASK、APPROVE 文档
