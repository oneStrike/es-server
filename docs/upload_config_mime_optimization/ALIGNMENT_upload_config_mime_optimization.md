# Upload配置MIME类型优化 - 需求对齐文档

## 项目特性规范

### 当前项目信息
- **项目类型**: NestJS后端服务器
- **技术栈**: Node.js + TypeScript + NestJS + pnpm
- **配置系统**: @nestjs/config + 环境变量
- **当前状态**: 手动维护MIME类型定义，代码行数266行

### 当前MIME类型处理方式
- 使用硬编码的MIME类型数组
- 5种文件类型：imageType、audioType、videoType、documentType、archiveType
- 每个类型包含mimeTypes和extensions数组
- 支持环境变量覆盖默认配置
- 工具函数处理环境变量解析

## 原始需求

### 目标
使用npm包替代手动维护MIME类型，在保证功能不变的前提下精简代码

### 期望改进
1. **减少维护成本**: 不需要手动维护完整的MIME类型列表
2. **提高准确性**: 依赖权威的MIME类型数据库
3. **代码精简**: 减少硬编码的数组定义
4. **保持功能**: 维持所有现有功能和配置选项

## 需求边界确认

### 明确任务范围
**包含**:
- 集成mime-types npm包
- 重构MIME类型定义逻辑
- 保持所有环境变量支持
- 保持5种文件类型分类
- 保持配置接口不变
- 保持工具函数功能

**不包含**:
- 修改文件上传业务逻辑
- 改变配置文件结构
- 添加新的文件验证规则
- 修改其他配置模块

### 需求理解
1. **技术约束**: 保持与现有NestJS架构兼容
2. **性能要求**: 不增加额外的运行时开销
3. **兼容性**: 保持与现有环境变量配置的向后兼容
4. **维护性**: 减少手动维护工作

## 疑问澄清

### 已确认问题
- ✅ 项目已安装@types/mime-types，说明有相关类型需求
- ✅ 现有代码结构清晰，有良好的工具函数抽象
- ✅ 环境变量配置功能需要保留

### 需要确认的决策点
1. **是否需要结合file-type进行文件内容验证**？还是仅使用mime-types进行扩展名转换？
2. **是否保留所有当前支持的MIME类型**？还是依赖mime-types的默认配置？
3. **如何处理mime-types中没有的扩展名**？

## 技术约束

### 依赖限制
- 只能添加轻量级依赖
- 不能影响现有构建流程
- 必须与TypeScript类型系统兼容

### 集成约束
- 保持现有的配置接口UploadConfig不变
- 保持环境变量覆盖机制
- 保持工具函数的抽象级别
- 保持Docker支持

## 验收标准

### 功能验收
1. 所有文件类型分类正常工作
2. 环境变量配置完全兼容
3. MIME类型和扩展名映射准确
4. 配置导出接口不变

### 代码质量验收
1. 代码行数显著减少
2. 编译检查通过
3. 保持现有代码风格
4. 类型安全无警告

### 性能验收
1. 启动时间不增加
2. 内存使用不显著增加
3. 运行时性能不降低