# 类型定义审查报告

## 审查范围

- 扫描 apps/ 与 libs/ 下所有 .ts 文件
- 重点关注：.module.ts、.service.ts、.controller.ts、.entity.ts 及其他自定义 .ts 文件
- 类型定义范围：interface、type、enum（类作为业务实现不纳入迁移）

## 参考规范（以 growth-event.types.ts 为基准）

- 类型文件命名：<feature>.types.ts
- 类型文件内容：仅包含 interface/type（不含 enum）
- enum 统一迁移到 <feature>.constant.ts 并补充用途、取值含义、使用场景说明
- DTO class 继续保留在 dto/，不做迁移
- global.d.ts 属于全局类型增强文件，不迁移

## 违规文件清单（非 types 文件中的类型定义）

### apps

- apps/admin-api/src/common/decorators/audit.decorator.ts
  - interface: AuditMetadata
  - 建议迁移到：apps/admin-api/src/common/decorators/audit.types.ts
- apps/admin-api/src/global.d.ts
  - interface: FastifyRequest（模块增强）
  - 说明：global.d.ts 保持原位（例外）
- apps/app-api/src/global.d.ts
  - interface: FastifyRequest（模块增强）
  - 说明：global.d.ts 保持原位（例外）

### libs/base

- libs/base/src/base.module.ts
  - interface: BaseModuleOptions
  - 建议迁移到：libs/base/src/base.module.types.ts
- libs/base/src/interceptors/transform.interceptor.ts
  - interface: Response<T>
  - 建议迁移到：libs/base/src/interceptors/transform.types.ts
- libs/base/src/utils/requestParse.ts
  - interface: DeviceInfo, RequestParams, ParsedRequestData
  - 建议迁移到：libs/base/src/utils/request-parse.types.ts
- libs/base/src/utils/bytes.ts
  - type: ByteUnit
  - interface: BytesOptions
  - 建议迁移到：libs/base/src/utils/bytes.types.ts
- libs/base/src/modules/auth/auth.strategy.ts
  - interface: JwtPayload, ITokenStorageService
  - 建议迁移到：libs/base/src/modules/auth/auth.types.ts
- libs/base/src/modules/auth/base-token-storage.service.ts
  - type: TokenType
  - interface: ITokenEntity, CreateTokenDto, ITokenDelegate
  - 建议迁移到：libs/base/src/modules/auth/token-storage.types.ts
- libs/base/src/modules/auth/login-guard.service.ts
  - interface: LoginGuardConfig
  - 建议迁移到：libs/base/src/modules/auth/login-guard.types.ts
- libs/base/src/modules/captcha/captcha.service.ts
  - interface: CaptchaConfig
  - 建议迁移到：libs/base/src/modules/captcha/captcha.types.ts
- libs/base/src/decorators/api-doc.decorator.ts
  - interface: ApiDocOptions<TModel>
  - 建议迁移到：libs/base/src/decorators/api-doc.types.ts
- libs/base/src/config/upload.config.ts
  - type: UploadConfigInterface
  - 建议迁移到：libs/base/src/config/upload.types.ts
- libs/base/src/config/aliyun.config.ts
  - type: AliyunConfigInterface
  - 建议迁移到：libs/base/src/config/aliyun.types.ts
- libs/base/src/database/prisma.service.ts
  - type: PrismaClientType
  - 建议迁移到：libs/base/src/database/prisma.types.ts

### libs/forum

- libs/forum/src/sensitive-word/sensitive-word-detect.service.ts
  - interface: MatchedWord, DetectOptions
  - 建议迁移到：libs/forum/src/sensitive-word/sensitive-word.types.ts
- libs/forum/src/sensitive-word/sensitive-word-cache.service.ts
  - interface: CacheQueryConfig<T>
  - 建议迁移到：libs/forum/src/sensitive-word/sensitive-word.types.ts
- libs/forum/src/sensitive-word/utils/fuzzy-matcher.ts
  - interface: FuzzyMatchResult
  - 建议迁移到：libs/forum/src/sensitive-word/sensitive-word.types.ts
- libs/forum/src/sensitive-word/utils/trie-node.ts
  - interface: TrieNode
  - 建议迁移到：libs/forum/src/sensitive-word/sensitive-word.types.ts
- libs/forum/src/sensitive-word/utils/ac-automaton.ts
  - interface: MatchResult
  - 建议迁移到：libs/forum/src/sensitive-word/sensitive-word.types.ts
- libs/forum/src/section/section-permission.service.ts
  - type: Permission
  - 建议迁移到：libs/forum/src/section/section-permission.types.ts
- libs/forum/src/reply/dto/forum-reply.dto.ts
  - enum: ForumReplySortFieldEnum, ForumReplySortOrderEnum
  - 建议迁移到：libs/forum/src/reply/forum-reply.constant.ts

### libs/user

- libs/user/src/growth-event/growth-event.bus.ts
  - interface: UserGrowthEventBus
  - 建议迁移到：libs/user/src/growth-event/growth-event.types.ts

## 枚举迁移清单（需迁移到 constant 文件并补充注释）

- libs/user/src/growth-event/growth-event.types.ts
  - enum: UserGrowthEventStatus
  - 建议迁移到：libs/user/src/growth-event/growth-event.constant.ts
- libs/forum/src/reply/dto/forum-reply.dto.ts
  - enum: ForumReplySortFieldEnum, ForumReplySortOrderEnum
  - 建议迁移到：libs/forum/src/reply/forum-reply.constant.ts
- libs/base/src/modules/logger/types.ts
  - enum: LoggerLevel
  - 建议迁移到：libs/base/src/modules/logger/logger.constant.ts
- libs/base/src/enum/base.enum.ts
  - enum: EnablePlatformEnum, ApiTypeEnum, HttpMethodEnum, ContentTypeEnum, GenderEnum, WorkViewPermissionEnum
  - 建议迁移到：libs/base/src/base.constant.ts（或拆分至 base/constants 目录）
- libs/base/src/enum/user.enum.ts
  - enum: UserStatusEnum
  - 建议迁移到：libs/base/src/user.constant.ts

## 总结统计

- 涉及文件数：24 个
- 类型定义项：约 40 处（interface/type）
- 枚举迁移项：9 处
