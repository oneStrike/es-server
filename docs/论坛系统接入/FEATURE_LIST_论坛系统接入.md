# 论坛系统接入 - 功能清单

## 1. 功能清单总览

### 1.1 功能分类

| 分类 | 功能数 | 优先级 | 阶段 |
|------|--------|--------|------|
| 用户管理 | 8 | 高 | 第一阶段 |
| 板块管理 | 6 | 高 | 第一阶段 |
| 帖子管理 | 10 | 高 | 第一阶段 |
| 评论管理 | 6 | 高 | 第一阶段 |
| 点赞管理 | 5 | 高 | 第一阶段 |
| 搜索管理 | 5 | 高 | 第一阶段 |
| 通知管理 | 5 | 高 | 第一阶段 |
| 积分管理 | 6 | 中 | 第二阶段 |
| 等级管理 | 5 | 中 | 第二阶段 |
| 徽章管理 | 6 | 中 | 第二阶段 |
| 审核管理 | 5 | 中 | 第二阶段 |
| 分析管理 | 5 | 中 | 第二阶段 |
| 插件管理 | 5 | 低 | 第三阶段 |
| 开放API | 4 | 低 | 第三阶段 |

**总计**: 81个功能点

## 2. 第一阶段功能清单（核心功能）

### 2.1 用户管理（8个功能）

#### 2.1.1 用户注册

**功能描述**: 用户可以通过用户名、邮箱、密码注册论坛账号

**功能点**:
- [ ] 用户名注册（唯一性验证）
- [ ] 邮箱注册（唯一性验证）
- [ ] 密码加密存储（bcrypt）
- [ ] 验证码验证（防止恶意注册）
- [ ] 用户名格式验证（字母、数字、下划线，3-20位）
- [ ] 邮箱格式验证（正则表达式）
- [ ] 密码强度验证（至少8位，包含字母和数字）
- [ ] 昵称设置（可选，默认使用用户名）

**接口**:
- `POST /client/forum/user/register`

**验收标准**:
- 用户名唯一，重复注册返回错误
- 邮箱唯一，重复注册返回错误
- 密码加密存储，数据库中不可见明文
- 验证码正确才能注册成功
- 用户名、邮箱、密码格式验证正确
- 注册成功返回用户信息和JWT token

**技术实现**:
- 使用 `class-validator` 验证输入
- 使用 `bcrypt` 加密密码
- 使用 `jsonwebtoken` 生成JWT token
- 使用 `@nestjs/throttler` 限制注册频率

---

#### 2.1.2 用户登录

**功能描述**: 用户可以通过用户名/邮箱和密码登录论坛

**功能点**:
- [ ] 用户名登录
- [ ] 邮箱登录
- [ ] 密码验证（bcrypt）
- [ ] JWT token生成
- [ ] 登录失败次数限制（5次失败锁定30分钟）
- [ ] 登录日志记录

**接口**:
- `POST /client/forum/user/login`

**验收标准**:
- 用户名或邮箱正确，密码正确才能登录
- 密码错误返回错误信息
- 登录成功返回用户信息和JWT token
- 登录失败次数超过限制，账号被锁定
- 登录日志正确记录

**技术实现**:
- 使用 `bcrypt` 验证密码
- 使用 `jsonwebtoken` 生成JWT token
- 使用 Redis 记录登录失败次数
- 使用 Winston 记录登录日志

---

#### 2.1.3 获取个人资料

**功能描述**: 用户可以查看自己的个人资料

**功能点**:
- [ ] 获取用户基本信息（用户名、邮箱、昵称、头像）
- [ ] 获取论坛角色（普通用户、版主、管理员）
- [ ] 获取论坛等级
- [ ] 获取论坛积分
- [ ] 获取统计数据（帖子数、评论数、点赞数、关注数、粉丝数）
- [ ] 获取注册时间

**接口**:
- `GET /client/forum/user/profile`

**验收标准**:
- 返回完整的用户信息
- 统计数据准确
- 需要登录才能访问

**技术实现**:
- 使用 JWT 认证
- 从 `ClientUser` 表查询用户信息
- 使用 Redis 缓存用户资料（5分钟）

---

#### 2.1.4 更新个人资料

**功能描述**: 用户可以更新自己的个人资料

**功能点**:
- [ ] 更新昵称
- [ ] 更新头像
- [ ] 更新个人简介
- [ ] 验证昵称格式（2-20位）
- [ ] 验证头像URL格式
- [ ] 验证个人简介长度（最多200字）

**接口**:
- `POST /client/forum/user/update`

**验收标准**:
- 只能更新自己的资料
- 昵称、头像、个人简介格式验证正确
- 更新成功返回最新资料
- 更新后清除缓存

**技术实现**:
- 使用 JWT 认证
- 使用 `class-validator` 验证输入
- 更新成功后清除 Redis 缓存

---

#### 2.1.5 用户角色管理（管理后台）

**功能描述**: 管理员可以管理用户角色

**功能点**:
- [ ] 查询用户列表（支持分页、搜索）
- [ ] 设置用户为版主
- [ ] 设置用户为管理员
- [ ] 取消用户角色
- [ ] 查看用户角色历史

**接口**:
- `GET /admin/forum/user/list`
- `POST /admin/forum/user/set-role`
- `POST /admin/forum/user/cancel-role`

**验收标准**:
- 只有管理员可以访问
- 用户列表支持分页和搜索
- 角色设置成功
- 角色历史记录正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 事务更新用户角色
- 记录角色变更历史

---

#### 2.1.6 用户列表查询（管理后台）

**功能描述**: 管理员可以查询用户列表

**功能点**:
- [ ] 分页查询用户列表
- [ ] 按用户名搜索
- [ ] 按邮箱搜索
- [ ] 按角色筛选
- [ ] 按注册时间排序
- [ ] 按积分排序
- [ ] 按帖子数排序

**接口**:
- `GET /admin/forum/user/list`

**验收标准**:
- 只有管理员可以访问
- 分页参数正确
- 搜索和筛选功能正常
- 排序功能正常

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 分页查询
- 使用 Redis 缓存查询结果（5分钟）

---

#### 2.1.7 用户详情查询（管理后台）

**功能描述**: 管理员可以查看用户详情

**功能点**:
- [ ] 获取用户基本信息
- [ ] 获取用户统计数据
- [ ] 获取用户帖子列表
- [ ] 获取用户评论列表
- [ ] 获取用户积分记录
- [ ] 获取用户角色历史

**接口**:
- `GET /admin/forum/user/:id`

**验收标准**:
- 只有管理员可以访问
- 返回完整的用户信息
- 关联数据正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma `include` 预加载关联数据
- 使用 Redis 缓存用户详情（5分钟）

---

#### 2.1.8 用户封禁/解封（管理后台）

**功能描述**: 管理员可以封禁或解封用户

**功能点**:
- [ ] 封禁用户
- [ ] 解封用户
- [ ] 设置封禁原因
- [ ] 设置封禁时长
- [ ] 查看封禁记录

**接口**:
- `POST /admin/forum/user/ban`
- `POST /admin/forum/user/unban`

**验收标准**:
- 只有管理员可以访问
- 封禁用户后无法登录
- 解封用户后可以正常登录
- 封禁记录正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 在 `ClientUser` 表中添加 `isBanned` 字段
- 使用 Redis 记录封禁状态
- 记录封禁历史

---

### 2.2 板块管理（6个功能）

#### 2.2.1 创建板块（管理后台）

**功能描述**: 管理员可以创建论坛板块

**功能点**:
- [ ] 设置板块名称（唯一性验证）
- [ ] 设置板块描述
- [ ] 设置板块图标
- [ ] 设置板块排序
- [ ] 设置板块状态（启用/禁用）
- [ ] 验证板块名称格式（2-20位）

**接口**:
- `POST /admin/forum/board/create`

**验收标准**:
- 只有管理员可以访问
- 板块名称唯一，重复创建返回错误
- 板块名称格式验证正确
- 创建成功返回板块信息
- 创建成功后清除板块列表缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 `class-validator` 验证输入
- 使用 Prisma 创建板块
- 创建成功后清除 Redis 缓存

---

#### 2.2.2 更新板块（管理后台）

**功能描述**: 管理员可以更新板块信息

**功能点**:
- [ ] 更新板块名称
- [ ] 更新板块描述
- [ ] 更新板块图标
- [ ] 更新板块排序
- [ ] 更新板块状态
- [ ] 验证板块名称格式

**接口**:
- `POST /admin/forum/board/update`

**验收标准**:
- 只有管理员可以访问
- 板块名称唯一性验证
- 更新成功返回最新板块信息
- 更新成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 `class-validator` 验证输入
- 使用 Prisma 更新板块
- 更新成功后清除 Redis 缓存

---

#### 2.2.3 删除板块（管理后台）

**功能描述**: 管理员可以删除板块

**功能点**:
- [ ] 删除板块
- [ ] 检查板块下是否有帖子
- [ ] 有帖子时提示无法删除
- [ ] 删除成功后清除缓存

**接口**:
- `POST /admin/forum/board/delete`

**验收标准**:
- 只有管理员可以访问
- 板块下有帖子时无法删除
- 删除成功返回确认信息
- 删除成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 检查板块下是否有帖子
- 使用 Prisma 软删除板块
- 删除成功后清除 Redis 缓存

---

#### 2.2.4 板块列表查询

**功能描述**: 用户可以查询板块列表

**功能点**:
- [ ] 获取所有启用的板块
- [ ] 按排序字段排序
- [ ] 显示板块帖子数
- [ ] 显示板块版主列表
- [ ] 缓存板块列表（30分钟）

**接口**:
- `GET /client/forum/board/list`

**验收标准**:
- 只返回启用的板块
- 排序正确
- 帖子数准确
- 版主列表正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存板块列表（30分钟）
- 使用 Prisma 查询板块和关联数据
- 使用 `include` 预加载版主列表

---

#### 2.2.5 板块详情查询

**功能描述**: 用户可以查询板块详情

**功能点**:
- [ ] 获取板块基本信息
- [ ] 获取板块帖子列表（分页）
- [ ] 获取板块版主列表
- [ ] 缓存板块详情（5分钟）

**接口**:
- `GET /client/forum/board/:id`

**验收标准**:
- 返回完整的板块信息
- 帖子列表分页正确
- 版主列表正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存板块详情（5分钟）
- 使用 Prisma 查询板块和关联数据
- 使用 `include` 预加载帖子和版主列表

---

#### 2.2.6 版主管理（管理后台）

**功能描述**: 管理员可以管理板块版主

**功能点**:
- [ ] 添加版主
- [ ] 移除版主
- [ ] 查看版主列表
- [ ] 验证用户角色（只有普通用户可以设置为版主）

**接口**:
- `POST /admin/forum/board/add-moderator`
- `POST /admin/forum/board/remove-moderator`

**验收标准**:
- 只有管理员可以访问
- 添加版主成功
- 移除版主成功
- 版主列表正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 创建/删除版主关系
- 更新成功后清除缓存

---

### 2.3 帖子管理（10个功能）

#### 2.3.1 发布帖子

**功能描述**: 用户可以发布帖子

**功能点**:
- [ ] 选择板块
- [ ] 输入帖子标题（2-100位）
- [ ] 输入帖子内容（10-10000字）
- [ ] 上传图片（最多9张）
- [ ] 添加标签（最多5个）
- [ ] 敏感词过滤
- [ ] 发布频率限制（每分钟最多1条）
- [ ] 发布成功后增加用户积分
- [ ] 发布成功后增加用户帖子数

**接口**:
- `POST /client/forum/post/create`

**验收标准**:
- 需要登录才能发布
- 标题、内容、标签格式验证正确
- 敏感词过滤生效
- 发布频率限制生效
- 发布成功后积分和帖子数增加
- 发布成功后清除缓存

**技术实现**:
- 使用 JWT 认证
- 使用 `class-validator` 验证输入
- 使用 DOMPurify 过滤XSS
- 使用正则表达式过滤敏感词
- 使用 `@nestjs/throttler` 限制发布频率
- 使用 Prisma 事务创建帖子和更新用户数据
- 发布成功后清除 Redis 缓存

---

#### 2.3.2 更新帖子

**功能描述**: 用户可以更新自己的帖子

**功能点**:
- [ ] 更新帖子标题
- [ ] 更新帖子内容
- [ ] 更新图片
- [ ] 更新标签
- [ ] 敏感词过滤
- [ ] 只能更新自己的帖子
- [ ] 更新成功后清除缓存

**接口**:
- `POST /client/forum/post/update`

**验收标准**:
- 需要登录才能更新
- 只能更新自己的帖子
- 标题、内容、标签格式验证正确
- 敏感词过滤生效
- 更新成功后清除缓存

**技术实现**:
- 使用 JWT 认证
- 使用 `@ForumResourceGuard` 验证资源权限
- 使用 `class-validator` 验证输入
- 使用 DOMPurify 过滤XSS
- 使用正则表达式过滤敏感词
- 使用 Prisma 更新帖子
- 更新成功后清除 Redis 缓存

---

#### 2.3.3 删除帖子

**功能描述**: 用户可以删除自己的帖子

**功能点**:
- [ ] 删除帖子（软删除）
- [ ] 检查帖子下是否有评论
- [ ] 只能删除自己的帖子
- [ ] 删除成功后减少用户帖子数
- [ ] 删除成功后清除缓存

**接口**:
- `POST /client/forum/post/delete`

**验收标准**:
- 需要登录才能删除
- 只能删除自己的帖子
- 软删除生效（deletedAt字段）
- 删除成功后帖子数减少
- 删除成功后清除缓存

**技术实现**:
- 使用 JWT 认证
- 使用 `@ForumResourceGuard` 验证资源权限
- 使用 Prisma 软删除帖子
- 使用 Prisma 事务更新用户数据
- 删除成功后清除 Redis 缓存

---

#### 2.3.4 帖子列表查询

**功能描述**: 用户可以查询帖子列表

**功能点**:
- [ ] 分页查询帖子列表
- [ ] 按板块筛选
- [ ] 按标签筛选
- [ ] 按作者筛选
- [ ] 按发布时间排序
- [ ] 按浏览量排序
- [ ] 按点赞数排序
- [ ] 按评论数排序
- [ ] 缓存帖子列表（5分钟）

**接口**:
- `GET /client/forum/post/list`

**验收标准**:
- 分页参数正确
- 筛选功能正常
- 排序功能正常
- 缓存生效

**技术实现**:
- 使用 Redis 缓存帖子列表（5分钟）
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选
- 使用 `orderBy` 排序

---

#### 2.3.5 帖子详情查询

**功能描述**: 用户可以查询帖子详情

**功能点**:
- [ ] 获取帖子基本信息
- [ ] 获取帖子作者信息
- [ ] 获取帖子板块信息
- [ ] 获取帖子标签
- [ ] 获取帖子图片
- [ ] 获取帖子统计数据（浏览量、点赞数、评论数）
- [ ] 获取当前用户是否点赞
- [ ] 增加帖子浏览量
- [ ] 缓存帖子详情（5分钟）

**接口**:
- `GET /client/forum/post/:id`

**验收标准**:
- 返回完整的帖子信息
- 浏览量增加
- 当前用户点赞状态正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存帖子详情（5分钟）
- 使用 Prisma 查询帖子和关联数据
- 使用 `include` 预加载关联数据
- 增加浏览量后更新缓存

---

#### 2.3.6 我的帖子

**功能描述**: 用户可以查看自己发布的帖子

**功能点**:
- [ ] 分页查询我的帖子
- [ ] 按发布时间排序
- [ ] 按浏览量排序
- [ ] 按点赞数排序
- [ ] 按评论数排序

**接口**:
- `GET /client/forum/post/my`

**验收标准**:
- 需要登录才能访问
- 只返回自己的帖子
- 分页参数正确
- 排序功能正常

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选当前用户的帖子
- 使用 `orderBy` 排序

---

#### 2.3.7 推荐帖子（管理后台）

**功能描述**: 管理员可以推荐帖子

**功能点**:
- [ ] 设置帖子为推荐
- [ ] 取消帖子推荐
- [ ] 设置推荐理由
- [ ] 查看推荐帖子列表

**接口**:
- `POST /admin/forum/post/recommend`
- `POST /admin/forum/post/unrecommend`

**验收标准**:
- 只有管理员可以访问
- 推荐成功
- 取消推荐成功
- 推荐列表正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 在 `ForumPost` 表中添加 `isRecommended` 字段
- 推荐成功后清除缓存

---

#### 2.3.8 热门帖子

**功能描述**: 用户可以查看热门帖子

**功能点**:
- [ ] 按浏览量排序
- [ ] 按点赞数排序
- [ ] 按评论数排序
- [ ] 按发布时间排序（最近7天）
- [ ] 缓存热门帖子（30分钟）

**接口**:
- `GET /client/forum/post/hot`

**验收标准**:
- 返回热门帖子
- 排序正确
- 时间范围正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存热门帖子（30分钟）
- 使用 Prisma 查询帖子
- 使用 `where` 条件筛选最近7天的帖子
- 使用 `orderBy` 排序

---

#### 2.3.9 最新帖子

**功能描述**: 用户可以查看最新帖子

**功能点**:
- [ ] 按发布时间排序
- [ ] 分页查询
- [ ] 缓存最新帖子（5分钟）

**接口**:
- `GET /client/forum/post/latest`

**验收标准**:
- 返回最新帖子
- 排序正确
- 分页参数正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存最新帖子（5分钟）
- 使用 Prisma 分页查询
- 使用 `orderBy` 按发布时间排序

---

#### 2.3.10 删除帖子（管理后台）

**功能描述**: 管理员可以删除任意帖子

**功能点**:
- [ ] 删除帖子（软删除）
- [ ] 设置删除原因
- [ ] 查看删除记录

**接口**:
- `POST /admin/forum/post/delete`

**验收标准**:
- 只有管理员可以访问
- 可以删除任意帖子
- 删除原因记录正确
- 删除成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 软删除帖子
- 记录删除历史
- 删除成功后清除 Redis 缓存

---

### 2.4 评论管理（6个功能）

#### 2.4.1 发布评论

**功能描述**: 用户可以发布评论

**功能点**:
- [ ] 选择帖子
- [ ] 输入评论内容（1-500字）
- [ ] 回复评论（可选）
- [ ] 敏感词过滤
- [ ] 发布频率限制（每分钟最多5条）
- [ ] 发布成功后增加用户积分
- [ ] 发布成功后增加用户评论数

**接口**:
- `POST /client/forum/comment/create`

**验收标准**:
- 需要登录才能发布
- 评论内容格式验证正确
- 敏感词过滤生效
- 发布频率限制生效
- 发布成功后积分和评论数增加
- 发布成功后清除缓存

**技术实现**:
- 使用 JWT 认证
- 使用 `class-validator` 验证输入
- 使用 DOMPurify 过滤XSS
- 使用正则表达式过滤敏感词
- 使用 `@nestjs/throttler` 限制发布频率
- 使用 Prisma 事务创建评论和更新用户数据
- 发布成功后清除 Redis 缓存

---

#### 2.4.2 删除评论

**功能描述**: 用户可以删除自己的评论

**功能点**:
- [ ] 删除评论（软删除）
- [ ] 只能删除自己的评论
- [ ] 删除成功后减少用户评论数
- [ ] 删除成功后清除缓存

**接口**:
- `POST /client/forum/comment/delete`

**验收标准**:
- 需要登录才能删除
- 只能删除自己的评论
- 软删除生效
- 删除成功后评论数减少
- 删除成功后清除缓存

**技术实现**:
- 使用 JWT 认证
- 使用 `@ForumResourceGuard` 验证资源权限
- 使用 Prisma 软删除评论
- 使用 Prisma 事务更新用户数据
- 删除成功后清除 Redis 缓存

---

#### 2.4.3 评论列表查询

**功能描述**: 用户可以查询帖子的评论列表

**功能点**:
- [ ] 分页查询评论列表
- [ ] 按发布时间排序
- [ ] 按点赞数排序
- [ ] 显示回复评论
- [ ] 缓存评论列表（5分钟）

**接口**:
- `GET /client/forum/comment/list`

**验收标准**:
- 分页参数正确
- 排序功能正常
- 回复评论显示正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存评论列表（5分钟）
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选帖子的评论
- 使用 `orderBy` 排序

---

#### 2.4.4 我的评论

**功能描述**: 用户可以查看自己发布的评论

**功能点**:
- [ ] 分页查询我的评论
- [ ] 按发布时间排序
- [ ] 按点赞数排序

**接口**:
- `GET /client/forum/comment/my`

**验收标准**:
- 需要登录才能访问
- 只返回自己的评论
- 分页参数正确
- 排序功能正常

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选当前用户的评论
- 使用 `orderBy` 排序

---

#### 2.4.5 删除评论（管理后台）

**功能描述**: 管理员可以删除任意评论

**功能点**:
- [ ] 删除评论（软删除）
- [ ] 设置删除原因
- [ ] 查看删除记录

**接口**:
- `POST /admin/forum/comment/delete`

**验收标准**:
- 只有管理员可以访问
- 可以删除任意评论
- 删除原因记录正确
- 删除成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 软删除评论
- 记录删除历史
- 删除成功后清除 Redis 缓存

---

#### 2.4.6 评论审核（管理后台）

**功能描述**: 管理员可以审核评论

**功能点**:
- [ ] 通过审核
- [ ] 拒绝审核
- [ ] 设置审核原因
- [ ] 查看审核记录

**接口**:
- `POST /admin/forum/comment/approve`
- `POST /admin/forum/comment/reject`

**验收标准**:
- 只有管理员可以访问
- 审核成功
- 审核原因记录正确
- 审核成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 在 `ForumComment` 表中添加 `auditStatus` 字段
- 审核成功后清除 Redis 缓存

---

### 2.5 点赞管理（5个功能）

#### 2.5.1 点赞帖子

**功能描述**: 用户可以点赞帖子

**功能点**:
- [ ] 点赞帖子
- [ ] 检查是否已点赞
- [ ] 已点赞则取消点赞
- [ ] 点赞成功后增加帖子点赞数
- [ ] 点赞成功后发送通知给作者
- [ ] 点赞成功后清除缓存

**接口**:
- `POST /client/forum/like/post`

**验收标准**:
- 需要登录才能点赞
- 未点赞则点赞，已点赞则取消
- 点赞数正确
- 通知发送成功
- 缓存清除成功

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 查询点赞记录
- 使用 Prisma 事务创建/删除点赞记录和更新帖子数据
- 使用 Notification Service 发送通知
- 点赞成功后清除 Redis 缓存

---

#### 2.5.2 点赞评论

**功能描述**: 用户可以点赞评论

**功能点**:
- [ ] 点赞评论
- [ ] 检查是否已点赞
- [ ] 已点赞则取消点赞
- [ ] 点赞成功后增加评论点赞数
- [ ] 点赞成功后发送通知给作者
- [ ] 点赞成功后清除缓存

**接口**:
- `POST /client/forum/like/comment`

**验收标准**:
- 需要登录才能点赞
- 未点赞则点赞，已点赞则取消
- 点赞数正确
- 通知发送成功
- 缓存清除成功

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 查询点赞记录
- 使用 Prisma 事务创建/删除点赞记录和更新评论数据
- 使用 Notification Service 发送通知
- 点赞成功后清除 Redis 缓存

---

#### 2.5.3 取消点赞

**功能描述**: 用户可以取消点赞

**功能点**:
- [ ] 取消点赞帖子
- [ ] 取消点赞评论
- [ ] 取消成功后减少点赞数
- [ ] 取消成功后清除缓存

**接口**:
- `POST /client/forum/like/cancel`

**验收标准**:
- 需要登录才能取消
- 点赞数正确
- 缓存清除成功

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 删除点赞记录
- 使用 Prisma 事务更新帖子或评论数据
- 取消成功后清除 Redis 缓存

---

#### 2.5.4 我的点赞

**功能描述**: 用户可以查看自己点赞的帖子和评论

**功能点**:
- [ ] 分页查询点赞的帖子
- [ ] 分页查询点赞的评论
- [ ] 按点赞时间排序

**接口**:
- `GET /client/forum/like/posts`
- `GET /client/forum/like/comments`

**验收标准**:
- 需要登录才能访问
- 只返回自己点赞的内容
- 分页参数正确
- 排序功能正常

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选当前用户的点赞记录
- 使用 `orderBy` 按点赞时间排序

---

#### 2.5.5 点赞列表（管理后台）

**功能描述**: 管理员可以查看点赞列表

**功能点**:
- [ ] 分页查询点赞列表
- [ ] 按帖子筛选
- [ ] 按评论筛选
- [ ] 按用户筛选
- [ ] 按点赞时间排序

**接口**:
- `GET /admin/forum/like/list`

**验收标准**:
- 只有管理员可以访问
- 分页参数正确
- 筛选功能正常
- 排序功能正常

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选
- 使用 `orderBy` 按点赞时间排序

---

### 2.6 搜索管理（5个功能）

#### 2.6.1 搜索帖子

**功能描述**: 用户可以搜索帖子

**功能点**:
- [ ] 输入关键词搜索
- [ ] 按板块筛选
- [ ] 按标签筛选
- [ ] 按作者筛选
- [ ] 分页查询
- [ ] 记录搜索日志
- [ ] 缓存搜索结果（5分钟）

**接口**:
- `POST /client/forum/search/post`

**验收标准**:
- 搜索结果正确
- 筛选功能正常
- 分页参数正确
- 搜索日志记录正确
- 缓存生效

**技术实现**:
- 使用 PostgreSQL 全文搜索
- 使用 Prisma 查询帖子
- 使用 `where` 条件筛选
- 记录搜索日志到数据库
- 使用 Redis 缓存搜索结果（5分钟）

---

#### 2.6.2 搜索用户

**功能描述**: 用户可以搜索用户

**功能点**:
- [ ] 输入关键词搜索
- [ ] 按用户名搜索
- [ ] 按昵称搜索
- [ ] 分页查询
- [ ] 缓存搜索结果（5分钟）

**接口**:
- `POST /client/forum/search/user`

**验收标准**:
- 搜索结果正确
- 分页参数正确
- 缓存生效

**技术实现**:
- 使用 Prisma 查询用户
- 使用 `where` 条件筛选
- 使用 Redis 缓存搜索结果（5分钟）

---

#### 2.6.3 热门搜索

**功能描述**: 用户可以查看热门搜索

**功能点**:
- [ ] 显示搜索次数最多的关键词
- [ ] 按搜索次数排序
- [ ] 显示最近7天的热门搜索
- [ ] 缓存热门搜索（30分钟）

**接口**:
- `GET /client/forum/search/hot`

**验收标准**:
- 返回热门搜索
- 排序正确
- 时间范围正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存热门搜索（30分钟）
- 使用 Prisma 查询搜索日志
- 使用 `where` 条件筛选最近7天的搜索
- 使用 `orderBy` 按搜索次数排序

---

#### 2.6.4 搜索历史

**功能描述**: 用户可以查看自己的搜索历史

**功能点**:
- [ ] 分页查询搜索历史
- [ ] 按搜索时间排序
- [ ] 清空搜索历史

**接口**:
- `GET /client/forum/search/history`
- `POST /client/forum/search/clear-history`

**验收标准**:
- 需要登录才能访问
- 只返回自己的搜索历史
- 分页参数正确
- 排序功能正常
- 清空历史成功

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选当前用户的搜索历史
- 使用 `orderBy` 按搜索时间排序
- 使用 Prisma 删除搜索历史

---

#### 2.6.5 搜索统计（管理后台）

**功能描述**: 管理员可以查看搜索统计

**功能点**:
- [ ] 查看搜索次数统计
- [ ] 查看热门关键词
- [ ] 按时间范围筛选
- [ ] 导出搜索统计

**接口**:
- `GET /admin/forum/search/statistics`

**验收标准**:
- 只有管理员可以访问
- 统计数据正确
- 筛选功能正常
- 导出功能正常

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 查询搜索日志
- 使用 `where` 条件筛选
- 使用 Excel 导出搜索统计

---

### 2.7 通知管理（5个功能）

#### 2.7.1 通知列表

**功能描述**: 用户可以查看通知列表

**功能点**:
- [ ] 分页查询通知列表
- [ ] 按已读/未读筛选
- [ ] 按通知类型筛选（评论、点赞等）
- [ ] 按通知时间排序
- [ ] 显示未读通知数

**接口**:
- `GET /client/forum/notification/list`

**验收标准**:
- 需要登录才能访问
- 只返回自己的通知
- 分页参数正确
- 筛选功能正常
- 排序功能正常
- 未读通知数正确

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选当前用户的通知
- 使用 `orderBy` 按通知时间排序

---

#### 2.7.2 标记已读

**功能描述**: 用户可以标记通知为已读

**功能点**:
- [ ] 标记单个通知为已读
- [ ] 标记所有通知为已读
- [ ] 更新未读通知数

**接口**:
- `POST /client/forum/notification/read`
- `POST /client/forum/notification/read-all`

**验收标准**:
- 需要登录才能操作
- 标记成功
- 未读通知数更新正确

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 更新通知状态
- 更新未读通知数

---

#### 2.7.3 删除通知

**功能描述**: 用户可以删除通知

**功能点**:
- [ ] 删除单个通知
- [ ] 删除所有通知
- [ ] 更新未读通知数

**接口**:
- `POST /client/forum/notification/delete`
- `POST /client/forum/notification/delete-all`

**验收标准**:
- 需要登录才能操作
- 删除成功
- 未读通知数更新正确

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 删除通知
- 更新未读通知数

---

#### 2.7.4 通知设置

**功能描述**: 用户可以设置通知偏好

**功能点**:
- [ ] 设置是否接收评论通知
- [ ] 设置是否接收点赞通知
- [ ] 设置是否接收系统通知

**接口**:
- `POST /client/forum/notification/settings`

**验收标准**:
- 需要登录才能操作
- 设置成功
- 通知偏好生效

**技术实现**:
- 使用 JWT 认证
- 在 `ClientUser` 表中添加通知设置字段
- 使用 Prisma 更新用户设置

---

#### 2.7.5 发送通知（系统）

**功能描述**: 系统可以发送通知

**功能点**:
- [ ] 发送评论通知
- [ ] 发送点赞通知
- [ ] 发送系统通知
- [ ] 批量发送通知

**接口**:
- 内部服务接口

**验收标准**:
- 通知发送成功
- 通知内容正确
- 批量发送成功

**技术实现**:
- 使用 Notification Service 发送通知
- 使用 Prisma 创建通知记录
- 批量发送使用 Prisma 批量插入

---

## 3. 第二阶段功能清单（社区功能）

### 3.1 积分管理（6个功能）

#### 3.1.1 获取积分余额

**功能描述**: 用户可以查看自己的积分余额

**功能点**:
- [ ] 获取积分余额
- [ ] 获取当前等级
- [ ] 获取下一等级所需积分
- [ ] 缓存积分余额（5分钟）

**接口**:
- `GET /client/forum/point/balance`

**验收标准**:
- 需要登录才能访问
- 积分余额正确
- 等级信息正确
- 缓存生效

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 查询用户积分
- 使用 Redis 缓存积分余额（5分钟）

---

#### 3.1.2 获取积分记录

**功能描述**: 用户可以查看自己的积分记录

**功能点**:
- [ ] 分页查询积分记录
- [ ] 按积分类型筛选（获取、消费）
- [ ] 按时间范围筛选
- [ ] 按积分来源筛选（发帖、评论、点赞等）
- [ ] 按时间排序

**接口**:
- `GET /client/forum/point/log`

**验收标准**:
- 需要登录才能访问
- 只返回自己的积分记录
- 分页参数正确
- 筛选功能正常
- 排序功能正常

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选
- 使用 `orderBy` 按时间排序

---

#### 3.1.3 积分排行榜

**功能描述**: 用户可以查看积分排行榜

**功能点**:
- [ ] 分页查询积分排行榜
- [ ] 显示用户排名
- [ ] 显示用户信息（用户名、昵称、头像）
- [ ] 显示积分
- [ ] 缓存排行榜（30分钟）

**接口**:
- `GET /client/forum/point/rank`

**验收标准**:
- 分页参数正确
- 排名正确
- 用户信息正确
- 积分正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存排行榜（30分钟）
- 使用 Prisma 查询用户积分
- 使用 `orderBy` 按积分排序

---

#### 3.1.4 调整用户积分（管理后台）

**功能描述**: 管理员可以调整用户积分

**功能点**:
- [ ] 增加用户积分
- [ ] 减少用户积分
- [ ] 设置调整原因
- [ ] 记录积分调整历史

**接口**:
- `POST /admin/forum/point/adjust`

**验收标准**:
- 只有管理员可以访问
- 积分调整成功
- 调整原因记录正确
- 积分历史记录正确
- 调整成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 事务更新用户积分和创建积分记录
- 记录积分调整历史
- 调整成功后清除 Redis 缓存

---

#### 3.1.5 积分规则配置（管理后台）

**功能描述**: 管理员可以配置积分规则

**功能点**:
- [ ] 配置发帖积分
- [ ] 配置评论积分
- [ ] 配置点赞积分
- [ ] 配置被点赞积分
- [ ] 配置其他积分规则

**接口**:
- `POST /admin/forum/point/config`

**验收标准**:
- 只有管理员可以访问
- 积分规则配置成功
- 积分规则生效

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 在数据库中存储积分规则配置
- 使用 Redis 缓存积分规则

---

#### 3.1.6 积分统计（管理后台）

**功能描述**: 管理员可以查看积分统计

**功能点**:
- [ ] 查看积分总数统计
- [ ] 查看积分获取统计
- [ ] 查看积分消费统计
- [ ] 按时间范围筛选
- [ ] 导出积分统计

**接口**:
- `GET /admin/forum/point/statistics`

**验收标准**:
- 只有管理员可以访问
- 统计数据正确
- 筛选功能正常
- 导出功能正常

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 查询积分记录
- 使用 `where` 条件筛选
- 使用 Excel 导出积分统计

---

### 3.2 等级管理（5个功能）

#### 3.2.1 获取当前等级

**功能描述**: 用户可以查看自己的当前等级

**功能点**:
- [ ] 获取当前等级
- [ ] 获取等级名称
- [ ] 获取等级图标
- [ ] 获取当前积分
- [ ] 获取下一等级所需积分
- [ ] 获取等级权益
- [ ] 缓存等级信息（5分钟）

**接口**:
- `GET /client/forum/level/current`

**验收标准**:
- 需要登录才能访问
- 等级信息正确
- 积分信息正确
- 等级权益正确
- 缓存生效

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 查询用户积分和等级
- 使用 Redis 缓存等级信息（5分钟）

---

#### 3.2.2 等级列表

**功能描述**: 用户可以查看所有等级

**功能点**:
- [ ] 获取所有等级
- [ ] 显示等级名称
- [ ] 显示等级图标
- [ ] 显示所需积分
- [ ] 显示等级权益
- [ ] 缓存等级列表（1小时）

**接口**:
- `GET /client/forum/level/list`

**验收标准**:
- 等级列表完整
- 等级信息正确
- 等级权益正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存等级列表（1小时）
- 使用 Prisma 查询等级配置

---

#### 3.2.3 创建等级（管理后台）

**功能描述**: 管理员可以创建等级

**功能点**:
- [ ] 设置等级名称
- [ ] 设置等级图标
- [ ] 设置所需积分
- [ ] 设置等级权益
- [ ] 验证积分范围

**接口**:
- `POST /admin/forum/level/create`

**验收标准**:
- 只有管理员可以访问
- 等级创建成功
- 等级信息正确
- 创建成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 `class-validator` 验证输入
- 使用 Prisma 创建等级
- 创建成功后清除 Redis 缓存

---

#### 3.2.4 更新等级（管理后台）

**功能描述**: 管理员可以更新等级

**功能点**:
- [ ] 更新等级名称
- [ ] 更新等级图标
- [ ] 更新所需积分
- [ ] 更新等级权益
- [ ] 验证积分范围

**接口**:
- `POST /admin/forum/level/update`

**验收标准**:
- 只有管理员可以访问
- 等级更新成功
- 等级信息正确
- 更新成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 `class-validator` 验证输入
- 使用 Prisma 更新等级
- 更新成功后清除 Redis 缓存

---

#### 3.2.5 删除等级（管理后台）

**功能描述**: 管理员可以删除等级

**功能点**:
- [ ] 删除等级
- [ ] 检查是否有用户使用该等级
- [ ] 有用户使用时提示无法删除
- [ ] 删除成功后清除缓存

**接口**:
- `POST /admin/forum/level/delete`

**验收标准**:
- 只有管理员可以访问
- 有用户使用时无法删除
- 删除成功
- 删除成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 检查是否有用户使用该等级
- 使用 Prisma 删除等级
- 删除成功后清除 Redis 缓存

---

### 3.3 徽章管理（6个功能）

#### 3.3.1 获取我的徽章

**功能描述**: 用户可以查看自己获得的徽章

**功能点**:
- [ ] 获取已获得的徽章列表
- [ ] 显示徽章名称
- [ ] 显示徽章图标
- [ ] 显示徽章描述
- [ ] 显示获得时间
- [ ] 缓存徽章列表（5分钟）

**接口**:
- `GET /client/forum/badge/my`

**验收标准**:
- 需要登录才能访问
- 徽章列表完整
- 徽章信息正确
- 获得时间正确
- 缓存生效

**技术实现**:
- 使用 JWT 认证
- 使用 Prisma 查询用户徽章
- 使用 Redis 缓存徽章列表（5分钟）

---

#### 3.3.2 徽章列表

**功能描述**: 用户可以查看所有徽章

**功能点**:
- [ ] 获取所有徽章
- [ ] 显示徽章名称
- [ ] 显示徽章图标
- [ ] 显示徽章描述
- [ ] 显示徽章获取条件
- [ ] 显示是否已获得
- [ ] 缓存徽章列表（1小时）

**接口**:
- `GET /client/forum/badge/list`

**验收标准**:
- 徽章列表完整
- 徽章信息正确
- 获取条件正确
- 已获得状态正确
- 缓存生效

**技术实现**:
- 使用 Redis 缓存徽章列表（1小时）
- 使用 Prisma 查询徽章配置和用户徽章

---

#### 3.3.3 创建徽章（管理后台）

**功能描述**: 管理员可以创建徽章

**功能点**:
- [ ] 设置徽章名称
- [ ] 设置徽章图标
- [ ] 设置徽章描述
- [ ] 设置徽章获取条件
- [ ] 设置徽章类型（手动、自动）

**接口**:
- `POST /admin/forum/badge/create`

**验收标准**:
- 只有管理员可以访问
- 徽章创建成功
- 徽章信息正确
- 创建成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 `class-validator` 验证输入
- 使用 Prisma 创建徽章
- 创建成功后清除 Redis 缓存

---

#### 3.3.4 更新徽章（管理后台）

**功能描述**: 管理员可以更新徽章

**功能点**:
- [ ] 更新徽章名称
- [ ] 更新徽章图标
- [ ] 更新徽章描述
- [ ] 更新徽章获取条件
- [ ] 更新徽章类型

**接口**:
- `POST /admin/forum/badge/update`

**验收标准**:
- 只有管理员可以访问
- 徽章更新成功
- 徽章信息正确
- 更新成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 `class-validator` 验证输入
- 使用 Prisma 更新徽章
- 更新成功后清除 Redis 缓存

---

#### 3.3.5 删除徽章（管理后台）

**功能描述**: 管理员可以删除徽章

**功能点**:
- [ ] 删除徽章
- [ ] 检查是否有用户获得该徽章
- [ ] 有用户获得时提示无法删除
- [ ] 删除成功后清除缓存

**接口**:
- `POST /admin/forum/badge/delete`

**验收标准**:
- 只有管理员可以访问
- 有用户获得时无法删除
- 删除成功
- 删除成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 检查是否有用户获得该徽章
- 使用 Prisma 删除徽章
- 删除成功后清除 Redis 缓存

---

#### 3.3.6 颁发徽章（管理后台）

**功能描述**: 管理员可以给用户颁发徽章

**功能点**:
- [ ] 选择用户
- [ ] 选择徽章
- [ ] 设置颁发原因
- [ ] 检查用户是否已获得该徽章
- [ ] 已获得则提示

**接口**:
- `POST /admin/forum/badge/award`

**验收标准**:
- 只有管理员可以访问
- 徽章颁发成功
- 颁发原因记录正确
- 已获得则提示
- 颁发成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 检查用户是否已获得该徽章
- 使用 Prisma 创建用户徽章记录
- 颁发成功后清除 Redis 缓存

---

### 3.4 审核管理（5个功能）

#### 3.4.1 敏感词过滤

**功能描述**: 系统自动过滤敏感词

**功能点**:
- [ ] 配置敏感词列表
- [ ] 过滤帖子内容
- [ ] 过滤评论内容
- [ ] 返回敏感词位置
- [ ] 支持正则表达式

**接口**:
- 内部服务接口

**验收标准**:
- 敏感词过滤正确
- 敏感词位置准确
- 正则表达式支持正确

**技术实现**:
- 使用正则表达式匹配敏感词
- 在数据库中存储敏感词列表
- 使用 Redis 缓存敏感词列表

---

#### 3.4.2 审核列表（管理后台）

**功能描述**: 管理员可以查看待审核内容

**功能点**:
- [ ] 分页查询待审核帖子
- [ ] 分页查询待审核评论
- [ ] 按审核状态筛选
- [ ] 按时间排序
- [ ] 显示敏感词位置

**接口**:
- `GET /admin/forum/audit/posts`
- `GET /admin/forum/audit/comments`

**验收标准**:
- 只有管理员可以访问
- 分页参数正确
- 筛选功能正常
- 排序功能正常
- 敏感词位置显示正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选
- 使用 `orderBy` 按时间排序

---

#### 3.4.3 通过审核（管理后台）

**功能描述**: 管理员可以通过审核

**功能点**:
- [ ] 通过帖子审核
- [ ] 通过评论审核
- [ ] 设置审核意见
- [ ] 更新审核状态
- [ ] 清除缓存

**接口**:
- `POST /admin/forum/audit/approve`

**验收标准**:
- 只有管理员可以访问
- 审核通过成功
- 审核意见记录正确
- 审核状态更新正确
- 缓存清除成功

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 更新审核状态
- 记录审核历史
- 审核成功后清除 Redis 缓存

---

#### 3.4.4 拒绝审核（管理后台）

**功能描述**: 管理员可以拒绝审核

**功能点**:
- [ ] 拒绝帖子审核
- [ ] 拒绝评论审核
- [ ] 设置拒绝原因
- [ ] 更新审核状态
- [ ] 清除缓存

**接口**:
- `POST /admin/forum/audit/reject`

**验收标准**:
- 只有管理员可以访问
- 审核拒绝成功
- 拒绝原因记录正确
- 审核状态更新正确
- 缓存清除成功

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 更新审核状态
- 记录审核历史
- 审核成功后清除 Redis 缓存

---

#### 3.4.5 敏感词配置（管理后台）

**功能描述**: 管理员可以配置敏感词

**功能点**:
- [ ] 添加敏感词
- [ ] 删除敏感词
- [ ] 查看敏感词列表
- [ ] 支持正则表达式
- [ ] 批量导入敏感词

**接口**:
- `POST /admin/forum/audit/sensitive-word/add`
- `POST /admin/forum/audit/sensitive-word/delete`
- `GET /admin/forum/audit/sensitive-word/list`

**验收标准**:
- 只有管理员可以访问
- 敏感词添加成功
- 敏感词删除成功
- 敏感词列表正确
- 正则表达式支持正确
- 批量导入成功
- 配置成功后清除缓存

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 创建/删除敏感词
- 使用 Redis 缓存敏感词列表
- 配置成功后清除 Redis 缓存

---

### 3.5 分析管理（5个功能）

#### 3.5.1 用户分析（管理后台）

**功能描述**: 管理员可以查看用户分析

**功能点**:
- [ ] 查看用户总数
- [ ] 查看新增用户数
- [ ] 查看活跃用户数
- [ ] 按时间范围筛选
- [ ] 按用户类型筛选
- [ ] 导出用户分析

**接口**:
- `GET /admin/forum/analytics/user`

**验收标准**:
- 只有管理员可以访问
- 统计数据正确
- 筛选功能正常
- 导出功能正常

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 查询用户数据
- 使用 `where` 条件筛选
- 使用 Excel 导出用户分析

---

#### 3.5.2 内容分析（管理后台）

**功能描述**: 管理员可以查看内容分析

**功能点**:
- [ ] 查看帖子总数
- [ ] 查看评论总数
- [ ] 查看点赞总数
- [ ] 按时间范围筛选
- [ ] 按板块筛选
- [ ] 导出内容分析

**接口**:
- `GET /admin/forum/analytics/content`

**验收标准**:
- 只有管理员可以访问
- 统计数据正确
- 筛选功能正常
- 导出功能正常

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 查询内容数据
- 使用 `where` 条件筛选
- 使用 Excel 导出内容分析

---

#### 3.5.3 活跃度分析（管理后台）

**功能描述**: 管理员可以查看活跃度分析

**功能点**:
- [ ] 查看日活用户数
- [ ] 查看周活用户数
- [ ] 查看月活用户数
- [ ] 按时间范围筛选
- [ ] 导出活跃度分析

**接口**:
- `GET /admin/forum/analytics/activity`

**验收标准**:
- 只有管理员可以访问
- 统计数据正确
- 筛选功能正常
- 导出功能正常

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 查询活跃度数据
- 使用 `where` 条件筛选
- 使用 Excel 导出活跃度分析

---

#### 3.5.4 用户行为分析（管理后台）

**功能描述**: 管理员可以查看用户行为分析

**功能点**:
- [ ] 查看发帖行为统计
- [ ] 查看评论行为统计
- [ ] 查看点赞行为统计
- [ ] 查看搜索行为统计
- [ ] 按时间范围筛选
- [ ] 导出用户行为分析

**接口**:
- `GET /admin/forum/analytics/user-behavior`

**验收标准**:
- 只有管理员可以访问
- 统计数据正确
- 筛选功能正常
- 导出功能正常

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 查询用户行为数据
- 使用 `where` 条件筛选
- 使用 Excel 导出用户行为分析

---

#### 3.5.5 内容趋势分析（管理后台）

**功能描述**: 管理员可以查看内容趋势分析

**功能点**:
- [ ] 查看帖子发布趋势
- [ ] 查看评论发布趋势
- [ ] 查看点赞趋势
- [ ] 按时间范围筛选
- [ ] 导出内容趋势分析

**接口**:
- `GET /admin/forum/analytics/content-trend`

**验收标准**:
- 只有管理员可以访问
- 统计数据正确
- 筛选功能正常
- 导出功能正常

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 查询内容趋势数据
- 使用 `where` 条件筛选
- 使用 Excel 导出内容趋势分析

---

## 4. 第三阶段功能清单（扩展功能）

### 4.1 插件管理（5个功能）

#### 4.1.1 插件列表（管理后台）

**功能描述**: 管理员可以查看插件列表

**功能点**:
- [ ] 查看已安装插件
- [ ] 查看未安装插件
- [ ] 显示插件名称
- [ ] 显示插件描述
- [ ] 显示插件版本
- [ ] 显示插件状态

**接口**:
- `GET /admin/forum/plugin/list`

**验收标准**:
- 只有管理员可以访问
- 插件列表完整
- 插件信息正确
- 插件状态正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 查询插件配置
- 从文件系统读取插件信息

---

#### 4.1.2 安装插件（管理后台）

**功能描述**: 管理员可以安装插件

**功能点**:
- [ ] 选择插件
- [ ] 安装插件
- [ ] 执行插件安装脚本
- [ ] 更新插件状态
- [ ] 记录安装日志

**接口**:
- `POST /admin/forum/plugin/install`

**验收标准**:
- 只有管理员可以访问
- 插件安装成功
- 插件状态更新正确
- 安装日志记录正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 更新插件状态
- 执行插件安装脚本
- 记录安装日志

---

#### 4.1.3 卸载插件（管理后台）

**功能描述**: 管理员可以卸载插件

**功能点**:
- [ ] 选择插件
- [ ] 卸载插件
- [ ] 执行插件卸载脚本
- [ ] 更新插件状态
- [ ] 记录卸载日志

**接口**:
- `POST /admin/forum/plugin/uninstall`

**验收标准**:
- 只有管理员可以访问
- 插件卸载成功
- 插件状态更新正确
- 卸载日志记录正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 更新插件状态
- 执行插件卸载脚本
- 记录卸载日志

---

#### 4.1.4 插件配置（管理后台）

**功能描述**: 管理员可以配置插件

**功能点**:
- [ ] 选择插件
- [ ] 配置插件参数
- [ ] 保存插件配置
- [ ] 重启插件

**接口**:
- `POST /admin/forum/plugin/config`

**验收标准**:
- 只有管理员可以访问
- 插件配置保存成功
- 插件重启成功

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 保存插件配置
- 重启插件

---

#### 4.1.5 插件开发（开发者）

**功能描述**: 开发者可以开发插件

**功能点**:
- [ ] 提供插件开发文档
- [ ] 提供插件开发示例
- [ ] 提供插件测试工具
- [ ] 提供插件调试工具

**接口**:
- 文档和工具

**验收标准**:
- 文档完整
- 示例正确
- 工具可用

**技术实现**:
- 编写插件开发文档
- 提供插件开发示例
- 开发插件测试工具
- 开发插件调试工具

---

### 4.2 开放API（4个功能）

#### 4.2.1 API认证

**功能描述**: 第三方应用可以通过API密钥认证

**功能点**:
- [ ] 申请API密钥
- [ ] 验证API密钥
- [ ] 限制API调用频率
- [ ] 记录API调用日志

**接口**:
- `POST /client/forum/api/auth`

**验收标准**:
- API密钥验证正确
- 调用频率限制生效
- 调用日志记录正确

**技术实现**:
- 使用 JWT 认证API密钥
- 使用 `@nestjs/throttler` 限制调用频率
- 记录API调用日志

---

#### 4.2.2 获取帖子列表（开放API）

**功能描述**: 第三方应用可以获取帖子列表

**功能点**:
- [ ] 分页获取帖子列表
- [ ] 按板块筛选
- [ ] 按标签筛选
- [ ] 按时间范围筛选
- [ ] 限制返回字段

**接口**:
- `GET /client/forum/api/posts`

**验收标准**:
- 需要API认证
- 分页参数正确
- 筛选功能正常
- 返回字段正确

**技术实现**:
- 使用 JWT 认证API密钥
- 使用 Prisma 分页查询
- 使用 `where` 条件筛选
- 限制返回字段

---

#### 4.2.3 获取帖子详情（开放API）

**功能描述**: 第三方应用可以获取帖子详情

**功能点**:
- [ ] 获取帖子基本信息
- [ ] 获取帖子作者信息
- [ ] 获取帖子统计数据
- [ ] 限制返回字段

**接口**:
- `GET /client/forum/api/posts/:id`

**验收标准**:
- 需要API认证
- 返回字段正确
- 数据正确

**技术实现**:
- 使用 JWT 认证API密钥
- 使用 Prisma 查询帖子
- 限制返回字段

---

#### 4.2.4 API密钥管理（管理后台）

**功能描述**: 管理员可以管理API密钥

**功能点**:
- [ ] 创建API密钥
- [ ] 删除API密钥
- [ ] 查看API密钥列表
- [ ] 查看API调用统计
- [ ] 限制API调用频率

**接口**:
- `POST /admin/forum/api/create-key`
- `POST /admin/forum/api/delete-key`
- `GET /admin/forum/api/keys`
- `GET /admin/forum/api/statistics`

**验收标准**:
- 只有管理员可以访问
- API密钥创建成功
- API密钥删除成功
- API密钥列表正确
- API调用统计正确

**技术实现**:
- 使用 `@ForumRole('admin')` 装饰器限制权限
- 使用 Prisma 创建/删除API密钥
- 使用 Prisma 查询API密钥和调用日志
- 使用 `@nestjs/throttler` 限制调用频率

---

## 5. 功能优先级说明

### 5.1 高优先级功能（第一阶段）

**必须实现的功能**:
- 用户管理（8个功能）
- 板块管理（6个功能）
- 帖子管理（10个功能）
- 评论管理（6个功能）
- 点赞管理（5个功能）
- 搜索管理（5个功能）
- 通知管理（5个功能）

**总计**: 45个功能

### 5.2 中优先级功能（第二阶段）

**重要但可以延后的功能**:
- 积分管理（6个功能）
- 等级管理（5个功能）
- 徽章管理（6个功能）
- 审核管理（5个功能）
- 分析管理（5个功能）

**总计**: 27个功能

### 5.3 低优先级功能（第三阶段）

**可选功能**:
- 插件管理（5个功能）
- 开放API（4个功能）

**总计**: 9个功能

## 6. 功能依赖关系

### 6.1 第一阶段依赖关系

```
用户管理 → 帖子管理
用户管理 → 评论管理
用户管理 → 点赞管理
用户管理 → 通知管理
板块管理 → 帖子管理
帖子管理 → 评论管理
帖子管理 → 点赞管理
帖子管理 → 搜索管理
评论管理 → 点赞管理
点赞管理 → 通知管理
```

### 6.2 第二阶段依赖关系

```
用户管理 → 积分管理
积分管理 → 等级管理
用户管理 → 徽章管理
帖子管理 → 审核管理
评论管理 → 审核管理
用户管理 → 分析管理
帖子管理 → 分析管理
评论管理 → 分析管理
```

### 6.3 第三阶段依赖关系

```
第一阶段功能 → 插件管理
第一阶段功能 → 开放API
```

## 7. 功能验收标准

### 7.1 功能完整性

- [ ] 所有功能点都已实现
- [ ] 所有接口都已实现
- [ ] 所有验收标准都已满足

### 7.2 功能正确性

- [ ] 功能逻辑正确
- [ ] 数据验证正确
- [ ] 权限控制正确
- [ ] 缓存策略正确

### 7.3 性能要求

- [ ] API响应时间 < 500ms
- [ ] 支持1000+并发用户
- [ ] 缓存命中率 > 80%

### 7.4 安全要求

- [ ] JWT认证正常工作
- [ ] 权限控制生效
- [ ] XSS防护生效
- [ ] CSRF防护生效
- [ ] 防刷机制生效

### 7.5 代码质量

- [ ] 代码遵循现有项目规范
- [ ] 代码通过ESLint检查
- [ ] 代码通过Prettier格式化
- [ ] 代码通过TypeScript类型检查
- [ ] 单元测试覆盖率 > 80%

## 8. 下一步行动

1. **用户审核**: 请用户审核功能清单，确认功能点是否完整
2. **调整功能**: 根据用户反馈调整功能清单
3. **创建TASK文档**: 基于确认的功能清单创建任务文档
4. **开始开发**: 按照TASK文档开始开发
