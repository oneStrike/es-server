漫画模块修复_原子化任务清单

任务 01：修复章节创建的漫画存在性校验
- 输入契约：CreateComicChapterDto 中 comicId、sortOrder、requiredReadLevelId、requiredDownloadLevelId
- 输出契约：仅当漫画存在且章节号不冲突时创建章节
- 实现约束：使用 workComic 校验漫画存在性，保持异常文案一致
- 依赖关系：无
- 验收标准：传入不存在的 comicId 返回“关联的漫画不存在”

任务 02：补齐章节详情不存在的异常处理
- 输入契约：章节 id
- 输出契约：章节不存在时抛出统一异常
- 实现约束：保持 admin/app 两端语义一致
- 依赖关系：无
- 验收标准：id 不存在时返回“章节不存在”

任务 03：修复章节排序号唯一性校验边界
- 输入契约：UpdateComicChapterDto 中 sortOrder
- 输出契约：sortOrder=0 也进行重复校验
- 实现约束：仅在 sortOrder 明确传入时触发校验
- 依赖关系：无
- 验收标准：同漫画下 sortOrder=0 冲突被拒绝

任务 04：修复章节交换排序的临时值类型
- 输入契约：DragReorderDto 中 targetId、dragId
- 输出契约：交换排序时写入整数临时值
- 实现约束：避免浮点写入 Int 字段
- 依赖关系：无
- 验收标准：交换排序过程中不会因类型不匹配报错

任务 05：补齐章节阅读权限与积分规则校验
- 输入契约：chapterId、userId、readRule、requiredReadLevelId、readPoints
- 输出契约：不满足规则时拒绝阅读并不记录事件
- 实现约束：复用现有用户与等级校验逻辑
- 依赖关系：任务 02
- 验收标准：未登录/非会员/积分不足时返回明确错误

任务 06：补齐章节购买权限与积分规则校验
- 输入契约：chapterId、userId、readRule、readPoints
- 输出契约：不满足规则时拒绝购买并不记录事件
- 实现约束：购买与阅读规则一致
- 依赖关系：任务 05
- 验收标准：readRule 非购买时拒绝购买

任务 07：补齐章节下载权限与积分规则校验
- 输入契约：chapterId、userId、downloadRule、requiredDownloadLevelId、downloadPoints
- 输出契约：不满足规则时拒绝下载并不记录事件
- 实现约束：遵循下载规则枚举语义
- 依赖关系：任务 02
- 验收标准：downloadRule 禁止或不满足条件时返回明确错误

任务 08：统一章节内容存储格式
- 输入契约：章节内容读写 API
- 输出契约：contents 始终以 JSON 数组存储与读取
- 实现约束：读写路径一致化，避免字符串与数组混用
- 依赖关系：无
- 验收标准：新增/更新/删除/移动/清空后读取无类型异常

任务 09：修复漫画分页查询的空值保护
- 输入契约：QueryComicDto
- 输出契约：name/publisher/tagIds 为空时不产生无效条件
- 实现约束：仅在字段有值时加入 where 条件
- 依赖关系：无
- 验收标准：空条件分页查询返回正常数据

任务 10：补齐漫画创建的名称唯一性校验
- 输入契约：CreateComicDto.name
- 输出契约：名称重复时拒绝创建
- 实现约束：复用更新时的校验逻辑与错误文案
- 依赖关系：无
- 验收标准：重复名称创建返回“漫画名称已存在”

任务 11：验证与回归
- 输入契约：lint、type-check
- 输出契约：无 lint 与类型错误
- 实现约束：使用项目已有脚本
- 依赖关系：任务 01-10
- 验收标准：pnpm lint 与 pnpm type-check 均通过
