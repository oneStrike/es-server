敏感词检测解耦_任务清单

目标
- 将敏感词检测从 forum 模块解耦为公共模块
- 使用通用命名与通用表结构，不再保留 forum 前缀
- forum 模块不再包含敏感词实现逻辑，但可通过依赖公共模块进行调用

任务 01：定义公共敏感词模型与数据表
- 数据表：使用通用表名（例如 sensitive_word）
- 数据模型字段（保持一致）：
  - id：主键自增
  - word：敏感词（唯一）
  - replace_word：替换词
  - level：敏感级别（1=严重，2=一般，3=轻微）
  - type：敏感类型（1=政治，2=色情，3=暴力，4=广告，5=其他）
  - match_mode：匹配模式（1=精确，2=模糊，3=正则）
  - is_enabled：是否启用
  - hit_count：命中次数
  - last_hit_at：最后命中时间
  - version：版本号
  - remark：备注
  - created_by / updated_by：创建人/更新人
  - created_at / updated_at：创建/更新时间
- Prisma 模型要求：
  - 模型名与表名使用通用命名（禁止 forum 前缀）
  - 字段映射与表结构一致
- 依赖关系：无
- 验收标准：新表可独立创建并可被 Prisma 正常访问

任务 02：抽离公共敏感词模块（libs/sensitive-word）
- 目录与模块：
  - libs/sensitive-word/src/sensitive-word.module.ts
  - libs/sensitive-word/src/sensitive-word.service.ts
  - libs/sensitive-word/src/sensitive-word-cache.service.ts
  - libs/sensitive-word/src/sensitive-word-detect.service.ts
  - libs/sensitive-word/src/sensitive-word-statistics.service.ts
  - libs/sensitive-word/src/dto/*
  - libs/sensitive-word/src/index.ts
- 实现约束：
  - 对外导出 API 保持稳定，接口与 DTO 以通用命名为准
  - 不引入 forum 领域依赖
- 依赖关系：任务 01
- 验收标准：新模块可被独立引用

任务 03：移除 forum 内敏感词实现逻辑
- 变更范围：
  - 删除 libs/forum/sensitive-word 及其引用
  - apps/admin-api 中 forum 相关敏感词控制器与路由移除或迁移
- 依赖关系：任务 02
- 验收标准：forum 模块内无敏感词实现代码，但业务流程仍可调用公共检测服务

任务 04：新增公共敏感词管理接口
- 接口范围：
  - 管理端：分页、创建、更新、删除、启停
  - 公共检测：检测/替换/统计
- 实现约束：模块命名与路由禁止 forum 前缀
- 依赖关系：任务 02
- 验收标准：新接口可独立访问并返回正确

任务 05：forum 模块适配公共敏感词服务（确保可用）
- 变更范围：
  - forum 业务服务中替换为 @libs/sensitive-word 调用
  - 移除 forum 侧敏感词模块引用与配置
- 实现约束：
  - forum 仅作为调用方，不包含敏感词实现
  - 接口与业务行为保持可用
- 依赖关系：任务 02、任务 03
- 验收标准：forum 相关功能正常触发敏感词检测且结果符合规则

任务 06：调整 Prisma 生成与类型导出
- 变更范围：
  - prisma/models 目录下模型文件位置调整
  - prisma client 类型导出路径更新（如有）
- 依赖关系：任务 01
- 验收标准：pnpm prisma:generate 通过且类型引用无报错

任务 07：接口与统计功能对齐
- 保持接口一致：
  - 创建/更新/删除/启用状态
  - 敏感词检测、替换、统计
- 验收标准：公共模块行为完整可用

任务 08：数据与缓存策略保持一致
- 保留原有缓存键与 TTL 规则
- 保持热更新与 reload 行为一致
- 验收标准：缓存命中与重载逻辑无变化

任务 09：迁移种子数据
- 变更范围：
  - prisma/seed/modules/common/sensitive-word.ts 新建或迁移
- 依赖关系：任务 01
- 验收标准：初始化数据写入通用表

任务 10：回归与检查（含 forum 使用验证）
- 运行：
  - pnpm lint
  - pnpm type-check
- 核心用例：
  - 敏感词分页与更新
  - 文本检测/替换
  - 统计接口
- 额外用例：
  - forum 发帖/回复触发敏感词检测
- 验收标准：无 lint/类型错误，接口返回正确且 forum 功能可用
