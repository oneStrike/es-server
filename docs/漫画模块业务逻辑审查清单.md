漫画模块业务逻辑审查清单

范围
- apps/app-api/src/modules/comic
- apps/admin-api/src/modules/content-management/comic
- libs/content/src/comic/core
- libs/content/src/comic/chapter
- libs/content/src/comic/chapter-content

问题清单
1. 创建章节时的漫画存在性校验表错误
   - 位置：libs/content/src/comic/chapter/comic-chapter.service.ts createComicChapter
   - 现象：使用 workComicChapter.exists({ id: comicId }) 校验漫画存在，实际应校验 workComic
   - 影响：comicId 恰好与某章节 id 相同会误判存在，导致脏数据

2. 管理端获取章节详情缺少不存在校验
   - 位置：libs/content/src/comic/chapter/comic-chapter.service.ts getComicChapterDetail
   - 现象：findUnique 结果为空时直接返回，admin-api 使用该方法会返回空对象
   - 影响：接口语义不一致，前端难以区分空数据与不存在

3. 章节排序号为 0 时绕过唯一性校验
   - 位置：libs/content/src/comic/chapter/comic-chapter.service.ts updateComicChapter
   - 现象：sortOrder 判定使用 if (sortOrder) 导致 0 不触发重复校验
   - 影响：可能允许同漫画下 sortOrder=0 的重复数据

4. 章节交换排序使用浮点临时值
   - 位置：libs/content/src/comic/chapter/comic-chapter.service.ts swapChapterNumbers
   - 现象：临时值为 -Math.random() * 1000000，可能生成浮点数
   - 影响：sortOrder 为 Int 字段，浮点写入可能报错或隐式截断

5. 章节购买/下载/阅读未做权限与积分规则校验
   - 位置：libs/content/src/comic/chapter/comic-chapter.service.ts incrementViewCount / incrementPurchaseCount / reportDownload
   - 现象：未校验 readRule、downloadRule、requiredReadLevelId、readPoints、downloadPoints
   - 影响：非会员或积分不足用户也可购买/下载/阅读并触发事件

6. 章节内容存储类型不一致
   - 位置：libs/content/src/comic/chapter-content/chapter-content.service.ts addChapterContent / updateChapterContent / deleteChapterContent / moveChapterContent / clearChapterContents
   - 现象：新增/更新以数组写入，删除/移动/清空以 JSON 字符串写入
   - 影响：getChapterContents 直接强转为数组，遇到字符串会导致类型不一致或运行时异常

7. 漫画分页查询条件缺少空值与空数组保护
   - 位置：libs/content/src/comic/core/comic.service.ts getComicPage
   - 现象：name/publisher 为空时仍设置 contains；tagIds 为空数组时会产生 in: []
   - 影响：可能触发不必要的查询错误或返回空结果集

8. 创建漫画未校验名称唯一性
   - 位置：libs/content/src/comic/core/comic.service.ts createComic
   - 现象：创建时未检查名称重复，更新时才校验
   - 影响：可能产生同名漫画，影响检索与运营配置
