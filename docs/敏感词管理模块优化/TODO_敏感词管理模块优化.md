# 敏感词管理模块优化 - 待办事项

## 待办事项清单

### 1. 正则匹配模式实现
**优先级**: 低  
**描述**: 目前 MatchModeEnum 定义了 REGEX 模式，但尚未实现  
**影响**: 用户无法使用正则表达式进行敏感词匹配  
**建议**: 如果有业务需求，可以实现正则匹配功能  
**操作指引**:
- 在 `sensitive-word-detect.service.ts` 中添加正则匹配逻辑
- 在 `detect` 方法中添加 REGEX 模式的处理分支
- 编写相应的单元测试

### 2. 性能监控
**优先级**: 低  
**描述**: 缺少性能监控指标，无法跟踪敏感词检测耗时  
**影响**: 难以评估系统性能和发现性能瓶颈  
**建议**: 添加性能监控，记录检测耗时、缓存命中率等指标  
**操作指引**:
- 使用 NestJS 的 Logger 记录关键操作耗时
- 考虑集成 APM 工具（如 New Relic、Datadog）
- 添加性能统计接口，返回平均检测时间等指标

### 3. 缓存预热优化
**优先级**: 低  
**描述**: 当前缓存预热可能需要较长时间  
**影响**: 系统启动时间可能较长  
**建议**: 优化缓存预热策略，如异步加载、分批加载等  
**操作指引**:
- 在 `sensitive-word-cache.service.ts` 中实现异步预热
- 考虑使用 Redis Pipeline 批量加载
- 添加预热进度日志

### 4. 批量操作性能优化
**优先级**: 低  
**描述**: 批量导入导出操作可能在大数据量时性能不佳  
**影响**: 处理大量敏感词时可能较慢  
**建议**: 优化批量操作，如使用事务、批量插入等  
**操作指引**:
- 在 `sensitive-word.service.ts` 中使用 Prisma 的 `createMany` 方法
- 考虑添加进度反馈机制
- 实现分批处理，避免内存溢出

### 5. 测试模块开发
**优先级**: 待定  
**描述**: 根据用户要求，暂时不开发测试模块  
**影响**: 缺少端到端测试和集成测试  
**建议**: 根据实际需求决定是否开发  
**操作指引**:
- 如果需要开发，参考项目现有测试框架
- 创建 E2E 测试文件
- 编写集成测试用例

## 缺少的配置

### 1. Redis 配置
**位置**: `.env` 文件  
**描述**: 需要配置 Redis 连接信息  
**示例**:
```
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
```

### 2. 缓存 TTL 配置
**位置**: `libs/forum/src/sensitive-word/constant/sensitive-word-cache-constant.ts`  
**描述**: 已定义缓存 TTL 常量，可根据实际需求调整  
**当前值**:
- SENSITIVE_WORD_CACHE_TTL = 3600 (1小时)
- SENSITIVE_WORD_LIST_CACHE_TTL = 1800 (30分钟)

### 3. 模糊匹配配置
**位置**: `libs/forum/src/sensitive-word/utils/fuzzy-matcher.ts`  
**描述**: 已定义最大编辑距离为 2，可根据实际需求调整  
**当前值**: maxDistance = 2

## 环境要求

### 必需依赖
- Redis: 用于缓存敏感词数据
- PostgreSQL: 数据库
- Node.js: 运行环境

### 可选依赖
- APM 工具: 用于性能监控
- 日志收集工具: 如 ELK、Splunk 等

## 部署注意事项

### 1. 数据库迁移
在部署前，需要运行数据库迁移：
```bash
npm run prisma migrate deploy
```

### 2. 种子数据
如果需要初始化敏感词数据，运行：
```bash
npm run prisma db seed
```

### 3. Redis 连接
确保 Redis 服务已启动并可访问

### 4. 缓存预热
系统启动时会自动预热缓存，首次启动可能需要较长时间

## 监控建议

### 1. 关键指标
- 敏感词检测耗时
- 缓存命中率
- 数据库查询耗时
- API 响应时间

### 2. 告警规则
- 检测耗时超过阈值（如 100ms）
- 缓存命中率低于阈值（如 80%）
- 数据库查询失败
- Redis 连接失败

## 维护建议

### 1. 定期清理
- 定期清理长时间未命中的敏感词
- 定期清理过期缓存

### 2. 性能优化
- 定期分析慢查询
- 定期评估缓存策略
- 定期优化索引

### 3. 数据备份
- 定期备份敏感词数据
- 定期备份 Redis 缓存（如需要）

## 支持资源

### 文档
- 项目 README
- API 文档（Swagger）
- 敏感词模块设计文档

### 联系方式
- 如有问题，请联系开发团队

## 更新日志

### 2026-01-09
- 完成敏感词管理模块优化
- 实现所有核心功能
- 通过验收测试
