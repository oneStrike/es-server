# 账号登录失败锁定方案共识 (CONSENSUS)

## 1. 需求确认
- **目标**: 防止暴力破解，提升账号安全性。
- **机制**: 连续密码错误达到阈值后，临时锁定账号。
- **范围**: 仅针对账号/手机号 + 密码登录方式。

## 2. 核心参数
- **最大失败次数**: 5 次
- **统计窗口**: 5 分钟
- **锁定时间**: 30 分钟
- **提示信息**: 明确告知用户剩余次数或锁定剩余时间。

## 3. 技术方案
- **实现方式**: Redis
- **Key 设计**:
  - 计数器: `auth:login:fail:{userId}`
  - 锁定标记: `auth:login:lock:{userId}`
- **数据流**:
  1. 登录前检查 `lock` Key。
  2. 密码错误 -> `fail` Key 自增 -> 检查是否达到阈值 -> 达到则写入 `lock` Key。
  3. 密码正确 -> 删除 `fail` Key (重置计数)。

## 4. 验收标准
1. 正常登录不受影响。
2. 密码错误 1-4 次，提示剩余机会。
3. 密码错误第 5 次，提示账号已锁定。
4. 锁定期间再次尝试（即使密码正确），提示账号锁定中及剩余时间。
5. 30分钟后自动解锁。
