# 项目规范核查原子化任务清单

## 0. 规范基线与范围确认

- [ ] 收集并对齐注释规范适用范围与排除范围
- [ ] 对齐注释语言要求为中文并设为强制
- [ ] 对齐类型文件命名规则为 <feature>.types.ts
- [ ] 对齐 types 文件内容仅允许 interface/type
- [ ] 对齐 enum 必须迁移到 <feature>.constant.ts
- [ ] 对齐常量文件命名为 <feature>.constant.ts
- [ ] 对齐 Prisma 模型与操作注释要求
- [ ] 对齐 controller/dto/module 的注释豁免范围

## 1. 类型定义迁移任务（apps/admin-api）

- [x] 迁移 AuditMetadata 到 audit.types.ts
- [x] 调整 audit.decorator.ts 对 AuditMetadata 的导入
- [x] 校验编译无类型引用缺失

## 2. 类型定义迁移任务（libs/base）

- [x] 迁移 BaseModuleOptions 到 base.module.types.ts
- [x] 调整 base.module.ts 对 BaseModuleOptions 的导入
- [x] 迁移 Response<T> 到 transform.types.ts
- [x] 调整 transform.interceptor.ts 对 Response<T> 的导入
- [x] 迁移 DeviceInfo 到 request-parse.types.ts
- [x] 迁移 RequestParams 到 request-parse.types.ts
- [x] 迁移 ParsedRequestData 到 request-parse.types.ts
- [x] 调整 requestParse.ts 对以上类型的导入
- [x] 迁移 ByteUnit 到 bytes.types.ts
- [x] 迁移 BytesOptions 到 bytes.types.ts
- [x] 调整 bytes.ts 对 ByteUnit/BytesOptions 的导入
- [x] 迁移 JwtPayload 到 auth.types.ts
- [x] 迁移 ITokenStorageService 到 auth.types.ts
- [x] 调整 auth.strategy.ts 对以上类型的导入
- [x] 迁移 TokenType 到 token-storage.types.ts
- [x] 迁移 ITokenEntity 到 token-storage.types.ts
- [x] 迁移 CreateTokenDto 到 token-storage.types.ts
- [x] 迁移 ITokenDelegate 到 token-storage.types.ts
- [x] 调整 base-token-storage.service.ts 对以上类型的导入
- [x] 迁移 LoginGuardConfig 到 login-guard.types.ts
- [x] 调整 login-guard.service.ts 对 LoginGuardConfig 的导入
- [x] 迁移 CaptchaConfig 到 captcha.types.ts
- [x] 调整 captcha.service.ts 对 CaptchaConfig 的导入
- [x] 迁移 ApiDocOptions<TModel> 到 api-doc.types.ts
- [x] 调整 api-doc.decorator.ts 对 ApiDocOptions<TModel> 的导入
- [x] 迁移 UploadConfigInterface 到 upload.types.ts
- [x] 调整 upload.config.ts 对 UploadConfigInterface 的导入
- [x] 迁移 AliyunConfigInterface 到 aliyun.types.ts
- [x] 调整 aliyun.config.ts 对 AliyunConfigInterface 的导入
- [x] 迁移 PrismaClientType 到 prisma.types.ts
- [x] 调整 prisma.service.ts 对 PrismaClientType 的导入

## 3. 类型定义迁移任务（libs/forum）

- [x] 说明：敏感词模块实际位于 libs/sensitive-word，以下迁移已按实际路径完成
- [x] 迁移 MatchedWord 到 sensitive-word.types.ts
- [x] 迁移 DetectOptions 到 sensitive-word.types.ts
- [x] 调整 sensitive-word-detect.service.ts 对以上类型的导入
- [x] 迁移 CacheQueryConfig<T> 到 sensitive-word.types.ts
- [x] 调整 sensitive-word-cache.service.ts 对 CacheQueryConfig<T> 的导入
- [x] 迁移 FuzzyMatchResult 到 sensitive-word.types.ts
- [x] 调整 fuzzy-matcher.ts 对 FuzzyMatchResult 的导入
- [x] 迁移 TrieNode 到 sensitive-word.types.ts
- [x] 调整 trie-node.ts 对 TrieNode 的导入
- [x] 迁移 MatchResult 到 sensitive-word.types.ts
- [x] 调整 ac-automaton.ts 对 MatchResult 的导入
- [x] 迁移 Permission 到 section-permission.types.ts
- [x] 调整 section-permission.service.ts 对 Permission 的导入

## 4. 类型定义迁移任务（libs/user）

- [x] 迁移 UserGrowthEventBus 到 growth-event.types.ts
- [x] 调整 growth-event.bus.ts 对 UserGrowthEventBus 的导入

## 5. 枚举迁移与常量整理任务（libs/base）

- [x] 迁移 LoggerLevel 到 logger.constant.ts
- [x] 调整 modules/logger/types.ts 对 LoggerLevel 的引用
- [x] 迁移 base.enum.ts 中 EnablePlatformEnum 到 base.constant.ts
- [x] 迁移 base.enum.ts 中 ApiTypeEnum 到 base.constant.ts
- [x] 迁移 base.enum.ts 中 HttpMethodEnum 到 base.constant.ts
- [x] 迁移 base.enum.ts 中 ContentTypeEnum 到 base.constant.ts
- [x] 迁移 base.enum.ts 中 GenderEnum 到 base.constant.ts
- [x] 迁移 base.enum.ts 中 WorkViewPermissionEnum 到 base.constant.ts
- [x] 调整使用以上枚举的所有导入路径
- [x] 迁移 user.enum.ts 中 UserStatusEnum 到 user.constant.ts
- [x] 调整使用 UserStatusEnum 的所有导入路径

## 6. 枚举迁移与常量整理任务（libs/forum）

- [x] 迁移 ForumReplySortFieldEnum 到 forum-reply.constant.ts
- [x] 迁移 ForumReplySortOrderEnum 到 forum-reply.constant.ts
- [x] 调整 forum-reply.dto.ts 对枚举的导入
- [x] 调整引用 forum-reply.dto.ts 枚举的其他文件导入

## 7. 枚举迁移与常量整理任务（libs/user）

- [x] 迁移 UserGrowthEventStatus 到 growth-event.constant.ts
- [x] 调整 growth-event.types.ts 对 UserGrowthEventStatus 的导入
- [x] 调整引用 UserGrowthEventStatus 的其他文件导入

## 8. 注释规范补齐任务（常量与枚举）

- [ ] 为每个 constant 文件补齐文件级注释
- [ ] 为每个 enum 本身补齐用途说明
- [ ] 为每个 enum 值补齐语义说明
- [ ] 为每个常量对象补齐对象级用途说明
- [ ] 为每个常量键补齐含义/单位/约束说明

## 9. 注释规范补齐任务（类型与字段）

- [ ] 为每个 types 文件补齐类型用途说明
- [ ] 为每个 types 字段补齐含义/单位/可空/默认行为说明
- [ ] 为泛型类型补齐泛型参数说明

## 10. 注释规范补齐任务（Prisma 模型与操作）

- [ ] 为 Prisma 模型补齐模型级说明
- [ ] 为 Prisma 字段补齐字段级说明
- [x] 为 Prisma 索引补齐索引用途说明
- [x] 为 Service/Repository 中 Prisma 调用补齐业务目的说明
- [ ] 为事务操作补齐事务边界与原因说明
- [ ] 为幂等/软删/缓存写入补齐策略说明

## 11. 模块边界与复用核验任务（apps）

- [ ] 校验 apps 仅负责 API 编排而非核心业务
- [ ] 校验 controller 不直接访问底层数据库
- [ ] 校验 dto 目录仅包含 DTO class
- [ ] 校验 module 的依赖导入无循环

## 12. 模块边界与复用核验任务（libs）

- [ ] 校验 libs 承担核心业务逻辑与复用能力
- [ ] 校验 service 与 dto/constant/types 分层清晰
- [ ] 校验 index.ts 对外导出完整且一致
- [ ] 校验模块内命名与目录结构一致

## 13. 工程化合规核验任务

- [x] 校验 ESLint 覆盖 apps/libs/src/test 范围
- [x] 校验 eslint 忽略路径不遗漏生成代码目录
- [x] 校验 tsconfig.build.json 排除测试与生成代码
- [x] 校验 lint/type-check/test 脚本可执行
- [x] 校验 lint-staged 与 commitlint 规则一致

## 14. 最终验收任务

- [x] 执行 lint 并保证无错误
- [x] 执行 type-check 并保证无错误
- [x] 生成最终修复清单与剩余风险清单

### 最终修复清单

- 补齐 Prisma 调用服务的业务目的说明
- 修复 ESLint 忽略配置以覆盖 test 目录
- 修正 tsconfig.build.json 的 spec 排除规则
- 补齐 lint:staged 脚本以匹配 pre-commit

### 剩余风险清单

- 常量与枚举注释未全面补齐（第 8 项未完成）
- types 注释未全面补齐（第 9 项未完成）
- Prisma 模型/字段注释与事务/幂等策略未全面补齐（第 10 项部分未完成）
- apps 与 libs 的模块边界全量核验仍待细化（第 11/12 项部分未完成）

## 15. 逐文件原子化拆解清单

### apps/admin-api

- [x] 文件：apps/admin-api/src/common/decorators/audit.decorator.ts
  - [x] 识别 AuditMetadata 定义段落并记录行号
  - [x] 将 AuditMetadata 从 audit.decorator.ts 删除
  - [x] 在 audit.types.ts 中新增 AuditMetadata 定义
  - [x] 更新 audit.decorator.ts 中 AuditMetadata 的导入路径
  - [x] 搜索并更新其他文件对 AuditMetadata 的导入路径

### libs/base

- [x] 文件：libs/base/src/base.module.ts
  - [x] 识别 BaseModuleOptions 定义段落并记录行号
  - [x] 将 BaseModuleOptions 从 base.module.ts 删除
  - [x] 在 base.module.types.ts 中新增 BaseModuleOptions 定义
  - [x] 更新 base.module.ts 中 BaseModuleOptions 的导入路径
  - [x] 搜索并更新其他文件对 BaseModuleOptions 的导入路径
- [x] 文件：libs/base/src/interceptors/transform.interceptor.ts
  - [x] 识别 Response<T> 定义段落并记录行号
  - [x] 将 Response<T> 从 transform.interceptor.ts 删除
  - [x] 在 transform.types.ts 中新增 Response<T> 定义
  - [x] 更新 transform.interceptor.ts 中 Response<T> 的导入路径
  - [x] 搜索并更新其他文件对 Response<T> 的导入路径
- [x] 文件：libs/base/src/utils/requestParse.ts
  - [x] 识别 DeviceInfo/RequestParams/ParsedRequestData 定义段落并记录行号
  - [x] 将 DeviceInfo/RequestParams/ParsedRequestData 从 requestParse.ts 删除
  - [x] 在 request-parse.types.ts 中新增上述类型定义
  - [x] 更新 requestParse.ts 中类型导入路径
  - [x] 搜索并更新其他文件对上述类型的导入路径
- [x] 文件：libs/base/src/utils/bytes.ts
  - [x] 识别 ByteUnit/BytesOptions 定义段落并记录行号
  - [x] 将 ByteUnit/BytesOptions 从 bytes.ts 删除
  - [x] 在 bytes.types.ts 中新增上述类型定义
  - [x] 更新 bytes.ts 中类型导入路径
  - [x] 搜索并更新其他文件对上述类型的导入路径
- [x] 文件：libs/base/src/modules/auth/auth.strategy.ts
  - [x] 识别 JwtPayload/ITokenStorageService 定义段落并记录行号
  - [x] 将 JwtPayload/ITokenStorageService 从 auth.strategy.ts 删除
  - [x] 在 auth.types.ts 中新增上述类型定义
  - [x] 更新 auth.strategy.ts 中类型导入路径
  - [x] 搜索并更新其他文件对上述类型的导入路径
- [x] 文件：libs/base/src/modules/auth/base-token-storage.service.ts
  - [x] 识别 TokenType/ITokenEntity/CreateTokenDto/ITokenDelegate 定义段落并记录行号
  - [x] 将 TokenType/ITokenEntity/CreateTokenDto/ITokenDelegate 从 base-token-storage.service.ts 删除
  - [x] 在 token-storage.types.ts 中新增上述类型定义
  - [x] 更新 base-token-storage.service.ts 中类型导入路径
  - [x] 搜索并更新其他文件对上述类型的导入路径
- [x] 文件：libs/base/src/modules/auth/login-guard.service.ts
  - [x] 识别 LoginGuardConfig 定义段落并记录行号
  - [x] 将 LoginGuardConfig 从 login-guard.service.ts 删除
  - [x] 在 login-guard.types.ts 中新增 LoginGuardConfig 定义
  - [x] 更新 login-guard.service.ts 中 LoginGuardConfig 的导入路径
  - [x] 搜索并更新其他文件对 LoginGuardConfig 的导入路径
- [x] 文件：libs/base/src/modules/captcha/captcha.service.ts
  - [x] 识别 CaptchaConfig 定义段落并记录行号
  - [x] 将 CaptchaConfig 从 captcha.service.ts 删除
  - [x] 在 captcha.types.ts 中新增 CaptchaConfig 定义
  - [x] 更新 captcha.service.ts 中 CaptchaConfig 的导入路径
  - [x] 搜索并更新其他文件对 CaptchaConfig 的导入路径
- [x] 文件：libs/base/src/decorators/api-doc.decorator.ts
  - [x] 识别 ApiDocOptions<TModel> 定义段落并记录行号
  - [x] 将 ApiDocOptions<TModel> 从 api-doc.decorator.ts 删除
  - [x] 在 api-doc.types.ts 中新增 ApiDocOptions<TModel> 定义
  - [x] 更新 api-doc.decorator.ts 中 ApiDocOptions<TModel> 的导入路径
  - [x] 搜索并更新其他文件对 ApiDocOptions<TModel> 的导入路径
- [x] 文件：libs/base/src/config/upload.config.ts
  - [x] 识别 UploadConfigInterface 定义段落并记录行号
  - [x] 将 UploadConfigInterface 从 upload.config.ts 删除
  - [x] 在 upload.types.ts 中新增 UploadConfigInterface 定义
  - [x] 更新 upload.config.ts 中 UploadConfigInterface 的导入路径
  - [x] 搜索并更新其他文件对 UploadConfigInterface 的导入路径
- [x] 文件：libs/base/src/config/aliyun.config.ts
  - [x] 识别 AliyunConfigInterface 定义段落并记录行号
  - [x] 将 AliyunConfigInterface 从 aliyun.config.ts 删除
  - [x] 在 aliyun.types.ts 中新增 AliyunConfigInterface 定义
  - [x] 更新 aliyun.config.ts 中 AliyunConfigInterface 的导入路径
  - [x] 搜索并更新其他文件对 AliyunConfigInterface 的导入路径
- [x] 文件：libs/base/src/database/prisma.service.ts
  - [x] 识别 PrismaClientType 定义段落并记录行号
  - [x] 将 PrismaClientType 从 prisma.service.ts 删除
  - [x] 在 prisma.types.ts 中新增 PrismaClientType 定义
  - [x] 更新 prisma.service.ts 中 PrismaClientType 的导入路径
  - [x] 搜索并更新其他文件对 PrismaClientType 的导入路径
- [x] 文件：libs/base/src/modules/logger/types.ts
  - [x] 识别 LoggerLevel 定义段落并记录行号
  - [x] 将 LoggerLevel 从 modules/logger/types.ts 删除
  - [x] 在 logger.constant.ts 中新增 LoggerLevel 定义
  - [x] 更新 types.ts 中 LoggerLevel 的导入路径
  - [x] 搜索并更新其他文件对 LoggerLevel 的导入路径
- [x] 文件：libs/base/src/enum/base.enum.ts
  - [x] 识别 EnablePlatformEnum 定义段落并记录行号
  - [x] 识别 ApiTypeEnum 定义段落并记录行号
  - [x] 识别 HttpMethodEnum 定义段落并记录行号
  - [x] 识别 ContentTypeEnum 定义段落并记录行号
  - [x] 识别 GenderEnum 定义段落并记录行号
  - [x] 识别 WorkViewPermissionEnum 定义段落并记录行号
  - [x] 将上述枚举从 base.enum.ts 删除
  - [x] 在 base.constant.ts 中新增上述枚举定义
  - [x] 更新引用 base.enum.ts 的所有文件导入路径
- [x] 文件：libs/base/src/enum/user.enum.ts
  - [x] 识别 UserStatusEnum 定义段落并记录行号
  - [x] 将 UserStatusEnum 从 user.enum.ts 删除
  - [x] 在 user.constant.ts 中新增 UserStatusEnum 定义
  - [x] 更新引用 user.enum.ts 的所有文件导入路径

### libs/forum

- [x] 说明：敏感词模块实际位于 libs/sensitive-word，以下任务已按实际路径完成
- [x] 文件：libs/forum/src/sensitive-word/sensitive-word-detect.service.ts
  - [x] 识别 MatchedWord/DetectOptions 定义段落并记录行号
  - [x] 将 MatchedWord/DetectOptions 从 sensitive-word-detect.service.ts 删除
  - [x] 在 sensitive-word.types.ts 中新增上述类型定义
  - [x] 更新 sensitive-word-detect.service.ts 中类型导入路径
  - [x] 搜索并更新其他文件对上述类型的导入路径
- [x] 文件：libs/forum/src/sensitive-word/sensitive-word-cache.service.ts
  - [x] 识别 CacheQueryConfig<T> 定义段落并记录行号
  - [x] 将 CacheQueryConfig<T> 从 sensitive-word-cache.service.ts 删除
  - [x] 在 sensitive-word.types.ts 中新增 CacheQueryConfig<T> 定义
  - [x] 更新 sensitive-word-cache.service.ts 中类型导入路径
  - [x] 搜索并更新其他文件对 CacheQueryConfig<T> 的导入路径
- [x] 文件：libs/forum/src/sensitive-word/utils/fuzzy-matcher.ts
  - [x] 识别 FuzzyMatchResult 定义段落并记录行号
  - [x] 将 FuzzyMatchResult 从 fuzzy-matcher.ts 删除
  - [x] 在 sensitive-word.types.ts 中新增 FuzzyMatchResult 定义
  - [x] 更新 fuzzy-matcher.ts 中类型导入路径
  - [x] 搜索并更新其他文件对 FuzzyMatchResult 的导入路径
- [x] 文件：libs/forum/src/sensitive-word/utils/trie-node.ts
  - [x] 识别 TrieNode 定义段落并记录行号
  - [x] 将 TrieNode 从 trie-node.ts 删除
  - [x] 在 sensitive-word.types.ts 中新增 TrieNode 定义
  - [x] 更新 trie-node.ts 中类型导入路径
  - [x] 搜索并更新其他文件对 TrieNode 的导入路径
- [x] 文件：libs/forum/src/sensitive-word/utils/ac-automaton.ts
  - [x] 识别 MatchResult 定义段落并记录行号
  - [x] 将 MatchResult 从 ac-automaton.ts 删除
  - [x] 在 sensitive-word.types.ts 中新增 MatchResult 定义
  - [x] 更新 ac-automaton.ts 中类型导入路径
  - [x] 搜索并更新其他文件对 MatchResult 的导入路径
- [x] 文件：libs/forum/src/section/section-permission.service.ts
  - [x] 识别 Permission 定义段落并记录行号
  - [x] 将 Permission 从 section-permission.service.ts 删除
  - [x] 在 section-permission.types.ts 中新增 Permission 定义
  - [x] 更新 section-permission.service.ts 中类型导入路径
  - [x] 搜索并更新其他文件对 Permission 的导入路径
- [x] 文件：libs/forum/src/reply/dto/forum-reply.dto.ts
  - [x] 识别 ForumReplySortFieldEnum 定义段落并记录行号
  - [x] 识别 ForumReplySortOrderEnum 定义段落并记录行号
  - [x] 将上述枚举从 forum-reply.dto.ts 删除
  - [x] 在 forum-reply.constant.ts 中新增上述枚举定义
  - [x] 更新 forum-reply.dto.ts 中枚举导入路径
  - [x] 搜索并更新其他文件对上述枚举的导入路径

### libs/user

- [x] 文件：libs/user/src/growth-event/growth-event.bus.ts
  - [x] 识别 UserGrowthEventBus 定义段落并记录行号
  - [x] 将 UserGrowthEventBus 从 growth-event.bus.ts 删除
  - [x] 在 growth-event.types.ts 中新增 UserGrowthEventBus 定义
  - [x] 更新 growth-event.bus.ts 中类型导入路径
  - [x] 搜索并更新其他文件对 UserGrowthEventBus 的导入路径
- [x] 文件：libs/user/src/growth-event/growth-event.types.ts
  - [x] 识别 UserGrowthEventStatus 定义段落并记录行号
  - [x] 将 UserGrowthEventStatus 从 growth-event.types.ts 删除
  - [x] 在 growth-event.constant.ts 中新增 UserGrowthEventStatus 定义
  - [x] 更新 growth-event.types.ts 中枚举导入路径
  - [x] 搜索并更新其他文件对 UserGrowthEventStatus 的导入路径

## 16. 注释补齐逐文件拆解清单

### 常量文件

- [x] 为 libs/base/src/constant/base.constant.ts 补齐文件级注释与枚举值说明
- [x] 为 libs/base/src/constant/user.constant.ts 补齐文件级注释与枚举值说明
- [x] 为 libs/user/src/growth-event/growth-event.constant.ts 补齐文件级注释与枚举值说明
- [x] 为 libs/forum/src/reply/forum-reply.constant.ts 补齐文件级注释与枚举值说明

### 类型文件

- [x] 为 libs/base/src/base.module.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/interceptors/transform.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/utils/bytes.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/utils/request-parse.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/modules/auth/auth.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/modules/auth/token-storage.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/modules/auth/login-guard.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/modules/captcha/captcha.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/decorators/api-doc.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/config/upload.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/config/aliyun.types.ts 补齐类型用途与字段说明
- [x] 为 libs/base/src/database/prisma.types.ts 补齐类型用途与字段说明
- [x] 为 libs/forum/src/sensitive-word/sensitive-word.types.ts 补齐类型用途与字段说明
- [x] 为 libs/forum/src/section/section-permission.types.ts 补齐类型用途与字段说明
- [x] 为 libs/user/src/growth-event/growth-event.types.ts 补齐类型用途与字段说明

### Prisma 模型与操作

- [x] 为 prisma/models/app/app-config.prisma 逐字段补齐注释并核对索引说明
- [x] 为 prisma/models/forum/forum-config.prisma 逐字段补齐注释并核对索引说明
- [ ] 为所有调用 Prisma 的 service 文件补齐业务目的说明
