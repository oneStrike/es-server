## 问题分析

**现象**：TypeScript 报错 "类型 'FastifyRequest' 上不存在属性 'headers'"，但实际上 headers 属性在运行时是存在的。

**原因**：

1. 项目使用 Fastify 5.6.2 版本，该版本中 FastifyRequest 接口的类型定义发生了变化
2. headers 属性的类型定义为 `headers: RawRequest['headers'] & RequestType['headers']`，依赖于泛型参数
3. 当直接使用 `FastifyRequest` 而不指定泛型参数时，TypeScript 无法正确推断 headers 属性的类型

**影响范围**：

* `libs/base/src/utils/requestParse.ts` 文件中所有使用 `req.headers` 的地方

## 修复方案

### 方案 1：使用完整的泛型类型

修改 FastifyRequest 的导入和使用方式，指定完整的泛型参数：

```typescript
import type { FastifyRequest, RouteGenericInterface } from 'fastify'

// 使用时指定泛型参数
export function extractIpAddress(req: FastifyRequest<RouteGenericInterface>): string | undefined {
  // 正常使用 req.headers
}
```

### 方案 2：使用类型断言

在访问 headers 属性时使用类型断言：

```typescript
const forwardedFor = (req as any).headers['x-forwarded-for']
```

### 方案 3：使用 req.raw\.headers

通过 raw 属性访问底层请求对象的 headers：

```typescript
const forwardedFor = req.raw.headers['x-forwarded-for']
```

## 推荐方案

**推荐使用方案 1**，因为：

1. 符合 TypeScript 的类型安全原则
2. 不需要使用 any 类型，保持类型检查
3. 与 Fastify 5.x 的类型系统兼容

## 修复步骤

1. 修改 `libs/base/src/utils/requestParse.ts` 文件：

   * 更新 FastifyRequest 的导入，添加 RouteGenericInterface

   * 为所有使用 FastifyRequest 类型的函数参数添加泛型参数

2. 验证修复结果：

   * 运行 TypeScript 编译检查

   * 确保所有类型错误都已解决

## 预期结果

* TypeScript 编译不再报错

* 代码保持类型安全

* 运行时功能不受影响
