# 内容标签系统实现方案

## 1. 数据模型设计

### 1.1 标签基础模型
- **模型名**: `WorkTag`
- **主要字段**:
  - `id`: 主键ID
  - `name`: 标签名称（唯一）
  - `icon`: 标签图标URL（可选）
  - `popularity`: 人气值
  - `order`: 排序值
  - `isEnabled`: 是否启用
  - `createdAt`: 创建时间
  - `updatedAt`: 更新时间

### 1.2 标签与内容关联模型
- **模型名**: `WorkComicTag`
- **主要字段**:
  - `comicId`: 漫画ID
  - `tagId`: 标签ID
  - `createdAt`: 创建时间
  - `updatedAt`: 更新时间

## 2. API 设计

### 2.1 标签管理 API
- **创建标签**: `POST /admin/work/tag/create`
- **分页查询标签**: `GET /admin/work/tag/page`
- **获取标签详情**: `GET /admin/work/tag/detail`
- **更新标签**: `POST /admin/work/tag/update`
- **批量更新标签状态**: `POST /admin/work/tag/batch-update-status`
- **批量删除标签**: `POST /admin/work/tag/batch-delete`
- **标签拖拽排序**: `POST /admin/work/tag/order`

### 2.2 标签与内容关联 API
- **为内容添加标签**: `POST /admin/work/comic/:id/tags`
- **获取内容标签**: `GET /admin/work/comic/:id/tags`
- **更新内容标签**: `PUT /admin/work/comic/:id/tags`
- **删除内容标签**: `DELETE /admin/work/comic/:id/tags/:tagId`

### 2.3 标签搜索与过滤 API
- **搜索标签**: `GET /admin/work/tag/search`
- **按标签过滤内容**: `GET /client/work/comic/page?tags=1,2,3`

## 3. 实现步骤

### 3.1 数据模型实现
1. 创建 `prisma/models/work/work-tag.prisma` 文件，定义 `WorkTag` 模型
2. 创建 `prisma/models/work/comic/work-comic-tag.prisma` 文件，定义 `WorkComicTag` 模型
3. 更新 `WorkComic` 模型，添加与标签的关联关系

### 3.2 API 实现
1. 创建标签管理模块（`tag.module.ts`、`tag.controller.ts`、`tag.service.ts`）
2. 实现标签的 CRUD 功能
3. 在漫画模块中添加标签关联功能
4. 更新现有 API，支持按标签过滤内容

### 3.3 与现有系统集成
1. 确保标签系统与分类系统使用相同的设计模式和命名约定
2. 确保标签系统与现有内容模型（如漫画）正确关联
3. 确保 API 路由结构与现有系统一致
4. 确保权限控制与现有系统保持一致

## 4. 技术实现细节

### 4.1 数据模型设计原则
- 遵循现有项目的命名约定（如使用下划线命名法映射数据库字段）
- 添加适当的索引以优化查询性能
- 使用与现有模型相同的数据类型和约束

### 4.2 API 设计原则
- 遵循 RESTful API 设计规范
- 使用与现有 API 相同的请求和响应格式
- 添加适当的 Swagger 文档
- 实现相同的错误处理机制

### 4.3 代码风格与质量
- 遵循现有项目的代码风格和命名约定
- 实现完整的类型定义
- 添加适当的注释
- 确保代码可维护性和可扩展性

## 5. 预期效果

1. 标签系统与现有分类系统无缝集成
2. 支持标签的完整 CRUD 操作
3. 支持内容与标签的灵活关联
4. 支持按标签搜索和过滤内容
5. 保持与现有系统一致的用户体验和代码质量

## 6. 实现计划

1. **数据模型设计与实现**：1天
2. **API 实现**：2天
3. **测试与调试**：1天
4. **文档更新**：0.5天

## 7. 风险评估

1. **数据迁移风险**：无，新功能不涉及现有数据修改
2. **性能风险**：通过适当的索引设计和查询优化来避免
3. **兼容性风险**：遵循现有系统设计，确保兼容性

## 8. 验收标准

1. 标签系统的所有 API 正常工作
2. 标签与内容的关联功能正常
3. 标签的搜索和过滤功能正常
4. 与现有分类系统协同工作正常
5. 代码质量符合项目要求
6. 文档完整

## 9. 后续优化方向

1. 添加标签分组功能
2. 实现标签自动推荐
3. 添加标签统计分析功能
4. 支持标签的多语言
5. 实现标签的版本管理
