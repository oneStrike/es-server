/// 用户积分记录表 - 记录用户积分变化历史
model UserPointRecord {
  /// 主键ID
  id Int @id @default(autoincrement())

  /// 关联的用户ID
  userId Int @map("user_id")
  /// 关联的规则ID
  ruleId Int? @map("rule_id")
  /// 关联的事件ID
  eventId Int? @map("event_id")

  /// 积分变化（正数为获得，负数为消费）
  points Int
  /// 变化前积分
  beforePoints Int @map("before_points")
  /// 变化后积分
  afterPoints Int @map("after_points")

  /// 事件键
  eventKey String? @map("event_key") @db.VarChar(50)
  /// 备注
  remark String? @db.VarChar(500)

  /// 创建时间
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  /// 关联规则
  rule UserPointRule? @relation(fields: [ruleId], references: [id])
  /// 关联事件
  event UserGrowthEvent? @relation(fields: [eventId], references: [id], onDelete: SetNull)
  /// 关联用户
  user AppUser @relation("UserPointRecords", fields: [userId], references: [id], onDelete: Cascade)

  /// 用户索引
  @@index([userId])
  /// 规则索引
  @@index([ruleId])
  /// 事件索引
  @@index([eventId])
  /// 创建时间索引
  @@index([createdAt])
  /// 用户与创建时间索引
  @@index([userId, createdAt])
  @@map("user_point_record")
}
