/// 用户下载记录表
/// 记录用户对作品、章节等内容的下载操作
/// 支持下载计数统计和用户下载历史查询
model UserDownload {
  /// 主键ID（自增）
  id Int @id @default(autoincrement())

  /// 目标类型
  /// 1=漫画, 2=小说, 3=漫画章节, 4=小说章节
  /// 注意：章节必须区分漫画章节(3)和小说章节(4)，不能使用通用类型
  /// 作品必须区分漫画(1)和小说(2)，不能使用通用类型
  targetType Int @map("target_type") @db.SmallInt

  /// 目标ID
  /// 下载的具体目标ID
  /// - targetType=1/2 时：work.id（作品下载）
  /// - targetType=3/4 时：work_chapter.id（章节下载）
  targetId Int @map("target_id")

  /// 用户ID（关联 app_user.id）
  /// 执行下载操作的用户
  userId Int @map("user_id")

  /// 作品ID
  /// 下载内容所属的作品ID，便于按作品查询下载记录
  /// targetType=1/2 时与 targetId 相同
  /// targetType=3/4 时为章节所属作品ID
  workId Int @map("work_id")

  /// 作品类型
  /// 1=漫画, 2=小说
  /// 下载内容所属的作品类型
  workType Int @map("work_type") @db.SmallInt

  /// 创建时间（下载时间）
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  /// 关联用户
  user AppUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  /// 唯一约束：同一用户对同一目标只能下载一次（记录层面）
  @@unique([targetType, targetId, userId])
  /// 目标类型与目标ID联合索引
  @@index([targetType, targetId])
  /// 用户ID索引
  @@index([userId])
  /// 作品ID索引，用于查询某作品的下载记录
  @@index([workId])
  /// 作品类型索引
  @@index([workType])
  /// 创建时间索引
  @@index([createdAt])
  /// 表名映射
  @@map("user_download")
}
