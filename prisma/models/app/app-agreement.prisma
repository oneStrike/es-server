/// 应用协议表 - 存储隐私政策、用户协议等
model AppAgreement {
  /// 主键ID
  id Int @id @default(autoincrement())

  /// 协议标题
  title String @map("title") @db.VarChar(200)

  /// 协议内容 (HTML/Markdown)
  content String @map("content") @db.Text

  /// 版本号 (如 1.0.0, 20231027)
  version String @map("version") @db.VarChar(50)

  /// 是否强制重新同意 (用于重大更新，true则用户必须再次点击同意)
  isForce Boolean @default(false) @map("is_force")

  /// 是否展示在登录注册页 (true:展示, false:不展示)
  showInAuth Boolean @default(false) @map("show_in_auth")

  /// 是否已发布
  isPublished Boolean @default(false) @map("is_published")

  /// 发布时间
  publishedAt DateTime? @map("published_at") @db.Timestamptz(6)

  /// 创建时间
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  /// 更新时间
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  /// 签署记录关联
  agreementLogs AppAgreementLog[]

  /// 同标题与版本唯一约束
  @@unique([title, version])
  /// 标题与发布状态索引
  @@index([title, isPublished])
  @@map("app_agreement")
}

/// 应用协议签署记录表
model AppAgreementLog {
  /// 主键ID (使用BigInt防止记录过多)
  id BigInt @id @default(autoincrement())

  /// 用户ID
  userId Int @map("user_id")

  /// 协议ID
  agreementId Int @map("agreement_id")

  /// 签署时的协议版本快照
  version String @map("version") @db.VarChar(50)

  /// 签署时间
  agreedAt DateTime @default(now()) @map("agreed_at") @db.Timestamptz(6)

  /// 签署IP
  ipAddress String? @map("ip_address") @db.VarChar(45)

  /// 设备信息/UserAgent
  deviceInfo String? @map("device_info") @db.VarChar(500)

  /// 关联协议
  agreement AppAgreement @relation(fields: [agreementId], references: [id])

  /// 关联用户
  user AppUser @relation(fields: [userId], references: [id])

  /// 用户与协议索引
  @@index([userId, agreementId])
  /// 签署时间索引
  @@index([agreedAt])
  @@map("app_agreement_log")
}
