/// 漫画章节模型
model WorkComicChapter {
  /// 主键id
  id Int @id @default(autoincrement())

  /// 漫画ID
  comicId                 Int  @map("comic_id")
  /// 允许查看的会员等级ID
  requiredReadLevelId     Int? @map("required_read_level_id")
  /// 允许下载的会员等级ID
  requiredDownloadLevelId Int? @map("required_download_level_id")

  /// 章节标题
  title       String  @db.VarChar(100)
  /// 章节副标题或描述
  subtitle    String? @db.VarChar(200)
  /// 章节描述
  description String? @db.VarChar(1000)
  /// 漫画内容（JSON格式存储图片URL数组）
  contents    Json    @default("[]")

  /// 章节序号（用于排序）
  sortOrder Int @default(0) @map("sort_order")

  /// 查看规则（0=所有人, 1=登录用户, 2=会员, 3=积分购买）
  readRule     Int @default(0) @map("read_rule") @db.SmallInt
  /// 是否允许下载（0=禁止, 1=允许, 2=VIP可下载, 3=积分可下载）
  downloadRule Int @default(1) @map("download_rule") @db.SmallInt

  /// 阅读所需要的积分（积分购买时必填）
  readPoints     Int? @default(0) @map("read_points")
  /// 下载所需要的积分（积分可下载时必填）
  downloadPoints Int? @default(0) @map("download_points")

  /// 发布状态
  isPublished Boolean @default(false) @map("is_published")
  /// 是否为试读章节
  isPreview   Boolean @default(false) @map("is_preview")
  /// 是否允许评论
  canComment  Boolean @default(true) @map("can_comment")

  /// 发布时间
  publishAt DateTime? @map("publish_at") @db.Timestamptz(6)

  /// 阅读次数
  viewCount     Int @default(0) @map("view_count")
  /// 点赞数
  likeCount     Int @default(0) @map("like_count")
  /// 评论数
  commentCount  Int @default(0) @map("comment_count")
  /// 购买次数
  purchaseCount Int @default(0) @map("purchase_count")

  /// 备注
  remark String? @db.VarChar(1000)

  /// 创建时间
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  /// 更新时间
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  /// 软删除时间（用于数据恢复或归档）
  deletedAt DateTime? @map("deleted_at") @db.Timestamptz(6)

  /// 关联漫画
  relatedComic          WorkComic     @relation(fields: [comicId], references: [id], onDelete: Cascade)
  /// 关联下载权限等级
  requiredDownloadLevel AppLevelRule? @relation("ChapterDownloadLevel", fields: [requiredDownloadLevelId], references: [id])
  /// 关联阅读权限等级
  requiredReadLevel     AppLevelRule? @relation("ChapterReadLevel", fields: [requiredReadLevelId], references: [id])

  @@unique([comicId, sortOrder])
  @@index([comicId])
  @@index([comicId, sortOrder])
  @@index([isPublished, publishAt])
  @@index([readRule])
  @@index([isPreview])
  @@index([viewCount])
  @@index([likeCount])
  @@index([createdAt])
  @@index([publishAt])
  @@index([requiredReadLevelId])
  @@index([requiredDownloadLevelId])
  @@map("work_comic_chapter")
}
